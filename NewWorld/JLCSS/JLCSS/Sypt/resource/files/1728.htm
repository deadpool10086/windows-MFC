<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P>五.&nbsp;邻节点请求报文<BR>六.&nbsp;邻节点公告报文</P></td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>五.&nbsp;邻节点请求报文</STRONG><BR>&nbsp;&nbsp;&nbsp; IPv6主机发送邻节点请求报文来发现链路上的IPv6节点的链路层地址。在邻节点请求报文中通常会包含发送方的链路层地址。一般来说，邻节点请求报文在地址解析时是以多播的形式发送的，而在检验相邻节点的可到达性时则是以单播的形式发送的。<BR>&nbsp;&nbsp;&nbsp; 例如，假定本地链路是以太网，则在邻节点请求报文的以太网报头中：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 源地址字段的值为发送方网卡MAC地址；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 对于多播邻节点请求报文，目的地址字段的值为与目标的请求节点地址相对应的以太网MAC地址。对于单播邻节点请求报文目的地址字段的值为邻节点的单播MAC地址。<BR>&nbsp;&nbsp;&nbsp; 在邻节点请求报文的IPv6报头中：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 源地址字段的值为分配给发送方接口的单播IPv6地址，或者是在重复地址检测阶段的未指定的IPv6地址（::）；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 对于多播邻节点请求报文，目的地址字段的值为目标的请求节点地址。对于单播邻节点请求报文目的地址字段的值为目标的单播地址；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 跳限制字段的值为255。<BR>&nbsp;&nbsp;&nbsp; 邻节点请求报文的格式如下图5-12所示：</P>
<P align=center><IMG src="../upload/1223270878015_pic.gif"></P>
<P align=center>图5-12&nbsp; 邻节点请求报文的格式</P>
<P>&#61548;邻节点请求报文中各个字段的含义如下：<BR>&#61548;类型：此字段值为135。<BR>&#61548;代码：此字段值为0。<BR>&#61548;校验和：此字段的值为ICMPv6的校验和。<BR>&#61548;保留：所有位都置为零。<BR>&#61548;目的地址：目的地址字段表示目标的IPv6地址。<BR>&#61548;选项：这个字段为源链路层地址选项，源链路层地址选项中会包含发送方的链路层地址。<BR><STRONG>六.&nbsp;邻节点公告报文</STRONG><BR>&nbsp;&nbsp;&nbsp; IPv6节点发送邻节点公告报文来对邻节点请求报文进行响应。IPv6节点也会自发的发送邻节点公告报文，以通知相邻节点自己的链路层地址发生改变，或者自己的角色发生改变。<BR>&nbsp;&nbsp;&nbsp; 例如，假定本地链路是以太网，则在邻节点公告报文的以太网报头中：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 源地址字段的值为发送方网卡MAC地址；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 对于响应请求的邻节点公告报文，目的地址字段的值为邻节点请求报文的最初发送者的单播MAC地址，对于自发发送的邻节点公告报文，目的地址字段的值为33－33－00－00－00－01，这是与链路本地范围所有节点多播地址相对应的以太网MAC地址。<BR>&nbsp;&nbsp;&nbsp; 在邻节点公告报文的IPv6报头中：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 源地址字段的值为分配给发送接口的单播地址；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 对于响应请求的邻节点公告报文，目的地址字段的值为邻节点请求报文的最初发送者的单播IP地址。对于自发的邻节点公告报文，目的地址为链路本地范围所有节点多播地址（FF02::1）；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 跳限制字段的值为255。<BR>&nbsp;&nbsp;&nbsp; 邻节点公告报文的格式如图5-13所示：</P>
<P align=center><IMG src="../upload/1223270892000_pic.gif"></P>
<P align=center>图5-13&nbsp; 邻节点公告报文格式</P>
<P>&nbsp;&nbsp;&nbsp; 邻节点公告报文中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：此字段值为136。<BR>&nbsp;&nbsp;&nbsp; 代码：此字段值为0。<BR>&nbsp;&nbsp;&nbsp; 校验和：此字段的值为ICMPv6的校验和。<BR>&nbsp;&nbsp;&nbsp; 路由器标志：表示邻节点公告报文的发送者的角色。当发送者为路由器时，路由器标志为1；当发送者不是路由器时，路由器标志为0。<BR>&nbsp;&nbsp;&nbsp; 请求标志：为1时，表示已经发送了邻节点公告报文来响应邻节点请求报文。<BR>&nbsp;&nbsp;&nbsp; 覆盖标志：为1时，表示应该用包含在目标链路层地址选项中的链路层地址，来覆盖当前的邻节点高速缓存表项中的链路层地址。<BR>&nbsp;&nbsp;&nbsp; 保留：所有位都为0。<BR>&nbsp;&nbsp;&nbsp; 目的地址：目的地址表示要公告的地址。<BR>&nbsp;&nbsp;&nbsp; 选项：这个字段为目标链路层地址选项，目标链路层地址选项包含了邻节点公告报文的发送者的链路层地址。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 