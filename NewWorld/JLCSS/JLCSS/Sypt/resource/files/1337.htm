<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">三. IGMP协议简介<BR>四. IGMP报文格式<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; IGMPv2报文的格式<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; IGMPv3查询报文的格式<BR>&nbsp;&nbsp;&nbsp; 3.&nbsp; IGMPv3成员关系报告报文的格式<BR>&nbsp;&nbsp;&nbsp; 4.&nbsp; IGMPv3成员关系报告报文中的组记录<BR>五. IGMP封装<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 高层协议类型字段<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 生存时间字段<BR>&nbsp;&nbsp;&nbsp; 3.&nbsp; 目的IP地址</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>三. IGMP协议简介</STRONG><BR>&nbsp;&nbsp;&nbsp; 随着Internet的飞速发展，利用Internet进行多媒体传播的应用研究越来越多。对某些应用而言，点对点交换信息不管对网络还是对信息发送者，都是一种负担。因此，需要一种办法让本身规模较大而相对互连网又较小的工作组能相互方便、快捷地传递信息。这就引起了组播（Multicase）技术的发展。<BR>&nbsp;&nbsp;&nbsp; IGMP协议（Internet组管理协议）是“Internet Group Management Protocol”的缩写，它位于网络层。IGMP协议运行于主机和与主机直接相连的路由器之间，是IP主机用来报告多播组成员身份的协议。通过IGMP协议，一方面可以使主机通知本地路由器希望加入并接收某个特定组播组的信息；另一方面，路由器可以周期性地查询局域网内某个已知组的成员是否处于活动状态。<BR>&nbsp;&nbsp;&nbsp; IGMP使用预留的组播组地址224.0.0.1与本地路由器通信。<BR><STRONG>四. IGMP报文格式</STRONG><BR>&nbsp;&nbsp;&nbsp; IGMP协议目前有三个版本IGMP、IGMPv2和IGMPv3。其中IGMPv2有3种报文类型：查询报文，成员关系报告报文和退出报告报文。查询报文共有两种：一般的和特殊的。如下图所示：</P>
<P align=center><IMG src="../upload/1223624469921_pic.gif"></P>
<P align=center>图5-4&nbsp; IGMPv2的报文类型</P>
<P>&nbsp;&nbsp;&nbsp; IGMPv3有2种报文类型：查询报文和成员关系报告报文。<BR>&nbsp;&nbsp;&nbsp; 本书中将讨论IGMP版本2和IGMP版本3的相关知识，由于IGMP版本1现在已经很少使用了，所以本书不讨论IGMP版本1。<BR><STRONG>1.&nbsp; IGMPv2报文的格式</STRONG><BR>&nbsp;&nbsp;&nbsp; 下图给出了IGMP（版本2）报文的格式。</P>
<P align=center><IMG src="../upload/1222569919078_pic.gif"></P>
<P align=center>图5-5&nbsp; IGMP的报文格式</P>
<P>&nbsp;&nbsp;&nbsp; ●&nbsp; 类型：该字段定义了IGMP报文类型。表5-2给出了类型和对应的值。</P>
<P align=center>表5-2&nbsp; IGMP报文类型</P>
<P align=center><IMG src="../upload/1222569929437_pic.gif"></P>
<P>&nbsp;&nbsp;&nbsp; ●&nbsp; 最大响应时间：该字段定义了查询必须在多长时间内回答。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 校验和：该字段包含覆盖整个IGMP报文的校验和。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 组地址：该字段在一般的查询报文中值是0。在特殊的查询报文、成员关系报告报文以及退出报告报文中值为多播组地址。<BR><STRONG>2.&nbsp; IGMPv3查询报文的格式</STRONG><BR>&nbsp;&nbsp;&nbsp; IGMPv3查询分为三类：<BR>&nbsp;&nbsp;&nbsp; 普通查询：普通查询由多播路由器发出，用于获知邻接接口(即查询所传输的网络中所相连的接口)的完整的多播接收状态。在一个普通查询中，组地址字段和源数量(N)字段都为0。<BR>&nbsp;&nbsp;&nbsp; 指定组查询：由一台多播路由器发出，用于获知邻接接口中跟某一个IP地址相关的多播接收状态。在指定组查询中，组地址字段含有需要查询的那个组地址，源数量(N)字段为0。<BR>&nbsp;&nbsp;&nbsp; 指定组和源查询：由一台多播路由器发出，用于获知邻接接口是否需要接收来自指定的这些源的，发往指定组的多播数据报。在一个指定组和源的查询中，组地址字段含有要查询的多播地址,源地址[i]字段含有相关的源地址。<BR>&nbsp;&nbsp;&nbsp; 下图给出了IGMP（版本3）查询报文的格式。</P>
<P align=center><IMG src="../upload/1222569959703_pic.gif"></P>
<P align=center>图5-6&nbsp; IGMP查询报文的报文格式</P>
<P>&nbsp;&nbsp;&nbsp; IGMPv3查询报文各字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 类型：该字段定义了IGMP报文类型，查询报文该字段的值为0x11。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 最大响应代码：该指定在发送一个响应报告之前所允许的最大时间。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 校验和：该字段包含覆盖整个IGMP报文的校验和。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 组地址：当发送一个普通查询的时候，组地址字段必须被置0。当发送一个指定组查询或者发送一个指定组和源的查询时，必须被设置成要被查询的IP组地址。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 保留：该字段为全0，在接收时被忽略。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; S标志：S标志用来指定禁止路由器处理（Suppress Router-Side Processing）。当被设置为1时，表示任何路由器都不可以更新它们在收到查询时要更新的那些定时器。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 查询者健壮变量：如果不为0，查询者健壮变量中包含一个被查询者使用的健壮变量的值，如果查询者的健壮变量的值超过7，即该字段的最大值，那么查询者健壮变量被设成0。路由器取最近收到的查询中的查询者健壮变量值作为它们自己的健壮性变量的值。如果收到的查询者健壮变量全是0，那么接收者就使用缺省的健壮性变量值，或者是一个静态配置的值。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 查询者查询间隔代码：该字段指定查询者使用的查询间隔，以秒为单位。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 源数量：该字段表明该查询中存在多少个源地址。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 源地址：源地址[i]是n个IP单播地址的数组，n就是源数量字段的值。<BR><STRONG>3.&nbsp; IGMPv3成员关系报告报文的格式<BR></STRONG>&nbsp;&nbsp;&nbsp; 下图给出了IGMP（版本3）成员关系报告报文的格式。</P>
<P align=center><IMG src="../upload/1222569969031_pic.gif"></P>
<P align=center>图5-7&nbsp; IGMP成员关系报告报文的报文格式</P>
<P>&nbsp;&nbsp;&nbsp; IGMP成员关系报告报文各字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 类型：成员关系报告报文中该字段的值为0x22。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 保留：该字段为全0，在接收时被忽略。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 校验和：该字段包含覆盖整个IGMP报文的校验和。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 组记录数：该字段指定在报告存在多少个组记录。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 组记录：每一个组记录字段都是一整块数据，其中含有发送者在报告发送接口上的某一个多播组的成员关系。<BR><STRONG>4.&nbsp; IGMPv3成员关系报告报文中的组记录</STRONG><BR>&nbsp;&nbsp;&nbsp; 在IGMPv3成员关系报告报文中，组记录是一整块数据，它的格式如下图所示：</P>
<P align=center><IMG src="../upload/1222569993468_pic.gif"></P>
<P align=center>图5-8&nbsp; 组记录格式</P>
<P>&nbsp;&nbsp;&nbsp; 组记录格式中，各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 记录类型：当前定义了6种记录类型，如下表：</P>
<P align=center>表5-3&nbsp; 记录类型</P>
<P align=center><IMG src="../upload/1223343127281_pic.gif"></P>
<P>&nbsp;&nbsp;&nbsp; ●&nbsp; 辅助数据长度：该字段含有在组记录中的辅助数据的实际长度，其单位是32位。它有可能是0，这就表示辅助数据不存在。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 源数量：该字段标明在组记录中存在多少源地址。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 组地址：该字段标明该组记录从属的多播IP地址。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 源地址：该字段是一个数组，含有n个单播地址。n就是该记录的源数量(N)字段的值。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 辅助数据：该字段如果存在，它含有关于该组记录的一些附加信息。在IGMPv3中，没有定义任何辅助数据。所以，IGMPv3的实现在任何传输的组记录中都不应该含有任何辅助数据（即必须把辅助数据长度字段置0）。<BR><STRONG>五. IGMP封装</STRONG><BR>&nbsp;&nbsp;&nbsp; IGMP报文被封装在IP数据报中，如下图所示：</P>
<P align=center><IMG src="../upload/1239603447125_pic.gif"></P>
<P align=center>图5-9&nbsp; IGMP数据包的封装</P>
<P>&nbsp;&nbsp;&nbsp; 在IGMP数据包封装过程中，IP层有3个字段需要注意，它们是高层协议类型字段、生存时间字段和目的IP地址字段。<BR><STRONG>1.&nbsp; 高层协议类型字段</STRONG><BR>&nbsp;&nbsp;&nbsp; 对于IGMP协议，IP的高层协议类型字段值是2。高层协议类型字段值为2的所有IP数据包，其数据部分都交付给IGMP协议处理。<BR><STRONG>2.&nbsp; 生存时间字段</STRONG><BR>&nbsp;&nbsp;&nbsp; 当IGMP报文封装成IP数据报时，生存时间的值必须是1。因为IGMP的作用范围是局域网，IGMP报文不能够发送到局域网以外的地方。生存时间值为1保证了这个报文不离开这个局域网，因为到了下一个路由器这个数值就减小到零，因而这个数据包要被丢弃。<BR><STRONG>3.&nbsp; 目的IP地址</STRONG><BR>&nbsp;&nbsp;&nbsp; 下表给出了每一种类型报文的目的IP地址。</P>
<P align=center>表5-4&nbsp; 各种类型的目的IP地址</P>
<P align=center><IMG src="../upload/1222570022703_pic.gif"></P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 