<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">七. 高速缓存<BR>八. 压缩<BR>九. DNS封装</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>七. 高速缓存</STRONG><BR>&nbsp;&nbsp;&nbsp; 如果DNS服务器收到的需要解析的域名不在它的域中，它就会以递归的或迭代的解析方式请求父服务器。为提高效率，DNS使用高速缓存机制。当服务器向另一个服务器请求映射并收到它的响应时，在把响应发送给客户之前，DNS服务器先将这个响应存储在它的高速缓存中。若另一个客户请求同样的映射，它就检查高速缓存并解析这个域名。这时，DNS服务器把响应标记为未授权的，用来通知客户这个响应是来自高速缓存而不是来自一个授权的DNS服务器。这种高速缓存技术加速了解析过程。<BR>&nbsp;&nbsp;&nbsp; 地址与域名的映射关系是会发生变化的，如果DNS服务器将一个映射长期保存在高速缓存中，这个映射可能会过期，它可能把过期的映射发送给客户。目前有两种方法解决这个问题。第一种方法是权限服务器把生存时间（TTL）信息添加在映射上，生存时间定义了接收映射的服务器可以在高速缓存中保存本条映射的时间（以秒为单位）。经过这段时间后，这个映射就变成为无效的。第二种方法是DNS服务器对每一个高速缓存的映射保留一个TTL计数器。当TTL计数器到期时就清除这条映射。<BR><STRONG>八. 压缩</STRONG><BR>&nbsp;&nbsp;&nbsp; 当域名重复出现时，DNS就需要用偏移指针来替换。例如，在资源记录中，域名通常是问题记录的域名的重复。为了避免发生这样的重复，DNS定义了2字节的偏移指针，它指向前一次出现的该域或该域的一部分。这个指针的格式如下图所示：</P>
<P align=center><IMG src="../upload/1223254507000_pic.gif"></P>
<P align=center>图11-15&nbsp; 偏移指针</P>
<P>&nbsp;&nbsp;&nbsp; 例如，解析程序向本地服务器发送查询报文，要找出主机“chal.fhda.edu”的IP地址。这里将分开讨论查询报文和响应报文。<BR>&nbsp;&nbsp;&nbsp; 下图给出了解析程序发送出的查询报文。前两个字节是标识符（0x1333），它使响应报文与查询报文关联起来。因为解析程序可以向同一个DNS服务器发送多个查询，标识符有助于将不同的响应与查询对应起来。下一个字节是标志，其值为0x0100。查询报文如下图所示：</P>
<P align=center><IMG src="../upload/1223254516250_pic.gif"></P>
<P align=center>图11-16&nbsp; 查询报文</P>
<P>&nbsp;&nbsp;&nbsp; QR位定义报文是查询报文。OpCode是0000，表示是标准查询。这个报文只包含一个问题记录。域名是4chal4fhda3edu0。下一个2字节定义查询类型是IP地址；最后两个字节定义类是Internet。<BR>&nbsp;&nbsp;&nbsp; 下图给出了服务器的响应报文。</P>
<P align=center><IMG src="../upload/1223254546875_pic.gif"></P>
<P align=center>图11-17&nbsp; 响应报文</P>
<P>&nbsp;&nbsp;&nbsp; 除了标志不同的回答记录数是1，标志的值是0x8180以外，响应报文与查询报文相似。标志的值是0x8180，用二进制表示是10000001 10000000，把它划分为以下的几个字段：</P>
<P align=center><IMG src="../upload/1223254554281_pic.gif"></P>
<P align=center>图11-18&nbsp; 响应报文的标志字段</P>
<P>&nbsp;&nbsp;&nbsp; QR位定义报文是响应。OpCode是0000，它表示是标准的查询。递归可用（RA）和RD位的值设置为1。报文只包含一个问题记录和一个回答记录。问题记录是与查询报文一致的。回答记录有一个指针0xC00C（分成两行），它指向问题记录而不是重复这个域名。下一个字段定义域的类型（地址）。再下面一个字段定义类（Internet）。值为12000的字段是TTL（12000s）。再下面的字段是资源数据长度字段，资源数据是IP地址（153.18.8.105）。<BR><STRONG>九. DNS封装</STRONG><BR>&nbsp;&nbsp;&nbsp; DNS可以使用UDP封装，也可以使用TCP封装。服务器使用的是熟知端口号53。当响应报文的长度小于512字节时就使用UDP，因为大多数UDP封装受512字节的数据包长度限制。若响应报文的长度超过512字节，就要使用TCP封装。<BR>&nbsp;&nbsp;&nbsp; 若解析程序事先知道响应报文的长度超过512字节，就要使用TCP封装。例如，若次名字服务器（作为客户）需要主服务器传送数据，它就必须使用TCP连接，因为要传送的信息的长度通常是超过512字节的。<BR>&nbsp;&nbsp;&nbsp; 若解析程序不知道响应报文的长度，它可以使用UDP封装。若响应报文的长度超过512字节，服务器就截断这个报文，并把TC位置1。解析程序之后就打开TCP连接，并重复这个请求，以便从服务器得到完整的响应。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 