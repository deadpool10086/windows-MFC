<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">一.&nbsp;IPv6数据包结构<BR>二.&nbsp;IPv6报文格式<BR>三.&nbsp;IPv4与IPv6首部的比较</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>一.&nbsp;IPv6数据包结构</STRONG><BR>&nbsp;&nbsp;&nbsp; IPv6数据包由一个IPv6报头、零个或多个扩展报头和一个上层协议数据单元组成。IPv6数据包的结构如图2-1所示：</P>
<P align=center><IMG src="../upload/1223277059453_pic.gif"></P>
<P align=center>图2-1&nbsp; IPv6数据包结构</P>
<P>&nbsp;&nbsp;&nbsp; IPv6数据包由以下部分组成：<BR>1.&nbsp; IPv6报头<BR>&nbsp;&nbsp;&nbsp; IPv6报头总是存在的，其长度固定为40字节。<BR>2.&nbsp; 扩展报头<BR>&nbsp;&nbsp;&nbsp; IPv6数据包中可以包含零个或多个扩展报头，这些扩展报头可以具有不同的长度。IPv6报头中的下一个报头字段，指向第一个扩展报头。每个扩展报头中，都包含下一个报头字段，它指向下一个扩展报头。最后一个扩展报头指示出上层协议数据单元中的上层协议的报头，上层协议可以是TCP协议、UDP协议或者ICMPv6协议等。<BR>&nbsp;&nbsp;&nbsp; IPv6报头或扩展报头代替了现有的IPv4报头及其选项。新的扩展报头格式增强了IPv6的功能，使其可以支持未来的需求。与IPv4报头中的选项不同，IPv6扩展报头没有最大长度的限制，因此可以容纳IPv6通信所需要的所有扩展数据。<BR>3.&nbsp; 上层协议数据单元<BR>&nbsp;&nbsp;&nbsp; 上层协议数据单元（PDU）一般由上层协议报头和上层协议数据构成（上层协议数据单元可以是一个ICMPv6报文、一个TCP报文，或者一个UDP报文）。<BR>&nbsp;&nbsp;&nbsp; IPv6数据包的有效载荷由IPv6的扩展报头和上层PDU构成。一般来说，有效载荷的长度最多可以达到65535个字节。带有长度大于65535个字节的有效载荷的IPv6数据包成为超大包，也是可以发送的。<BR><STRONG>二.&nbsp;IPv6报文格式</STRONG><BR>&nbsp;&nbsp;&nbsp; IPv6的报文格式如图2-2所示：</P>
<P align=center><IMG src="../upload/1223261003671_pic.gif"></P>
<P align=center>图2-2&nbsp; IPv6报文格式</P>
<P>&nbsp;&nbsp;&nbsp; IPv6报文格式中的各个字段含义如下：<BR>&nbsp;&nbsp;&nbsp; 版本：版本字段长度为4位，IPv6版本号为6。<BR>&nbsp;&nbsp;&nbsp; 区分服务：该字段以前叫做通信流类别，表示IPv6数据包的类或优先级。通信流类别提供的功能类似于IPv4的服务类型字段。该字段在RFC2474中被重新定义,在新的定义中将该字段命名为区分服务，其中包含一个6位的区分服务码点(DSCP)字段和两个未用位CU字段。如图2-3所示：</P>
<P align=center><IMG src="../upload/1223261011125_pic.gif"></P>
<P align=center>图2-3 RFC2474定义的区分服务字段</P>
<P>&nbsp;&nbsp;&nbsp; 前6比特的区分服务码点的值用来映射一个底层的服务，它决定了每一跳行为。<BR>&nbsp;&nbsp;&nbsp; 在RFC3168中，将区分服务字段中的未用位字段定义为显示拥塞通告（ECN）字段，ECN字段包括2个子字段，分别为：ECT字段和CE字段，如图2-4所示：</P>
<P align=center><IMG src="../upload/1223261020156_pic.gif"></P>
<P align=center>图2-4 RFC3168定义的区分服务字段</P>
<P>&nbsp;&nbsp;&nbsp; ECN字段用于指定发送数据的主机是否支持拥塞通告以及指示网络中是否有拥塞发生。ECN通过两个子字段的不同值组合来做到这一点：<BR>&nbsp;&nbsp;&nbsp; 00：发送主机不支持ECN。<BR>&nbsp;&nbsp;&nbsp; 01或10：发送主机支持ECN。<BR>&nbsp;&nbsp;&nbsp; 11：路由器正在经历拥塞。<BR>&nbsp;&nbsp;&nbsp; 流标签：流是指源点，信宿和流标记三者分别相同的数据包的集合。一个流由其源地址，目的地址和流序号来命名。任何的流标签都不得在此路由器中保持6s以上。<BR>&nbsp;&nbsp;&nbsp; 有效载荷长度：有效载荷长度域指示IP基本头以后的IP数据包剩余部分的长度，单位是字节。IP数据包通常长度在65535字节以内。如果使用逐跳选项扩展头的特大净荷选项，就能传送更大的数据包，此时有效载荷长度置零。<BR>&nbsp;&nbsp;&nbsp; 下一个报头：下一个报头用来标识数据包中的基本IP头的下一个报头。<BR>&nbsp;&nbsp;&nbsp; 跳限制：跳限制字段决定了能够将数据包传送到多远。<BR>&nbsp;&nbsp;&nbsp; 源地址：源地址字段定义了源主机的IP地址。<BR>&nbsp;&nbsp;&nbsp; 目的地址：目的地址字段定义了目的主机的IP地址。如果出现路由头，这个地址可能不是最终的接收数据包的主机的IPv6地址。<BR><STRONG>三. IPv4与IPv6首部的比较</STRONG><BR>&nbsp;&nbsp;&nbsp; 比较IPv4和IPv6的报头，可以看到以下几个特点：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 字段的数量从IPv4中的13（包括选项）个，降到了IPv6中的8个；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 中间路由器必须处理的字段从6个降到了4个，这就可以更有效地转发普通的IPv6数据包；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 很少使用的字段，如支持拆分的字段，以及IPv4报头中的选项，被移到了IPv6报头的扩展报头中；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; IPv6报头的长度是IPv4最小报头长度（20字节）的两倍，达到40字节。然而，新的IPv6报头中包含的源地址和目的地址的长度，是IPv4源地址和目的地址的4倍。<BR>&nbsp;&nbsp;&nbsp; 表2-1列出了IPv4报头和IPv6报头的各个字段的区别。 </P>
<P align=center>表2-1&nbsp; IPv4与IPv6首部比较</P>
<P align=center><IMG src="../upload/1223261077625_pic.gif"></P>
<P>&nbsp;&nbsp;&nbsp; IPv6报头中只有一个在IPv4报头中没有的新字段，这就是流标签字段。<BR>&nbsp;&nbsp;&nbsp; 在IPv6数据包中，可以包含零个或者多个扩展报头，下面我们将详细讨论各种扩展报头。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 