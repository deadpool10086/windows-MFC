<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">六. 多播组成员的加入与退出<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 加入一个组<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 退出一个组<BR>七. 监视成员关系<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 延迟响应</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>六. 多播组成员的加入与退出(
<OBJECT codeBase=http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0 classid=clsid:D27CDB6E-AE6D-11cf-96B8-444553540000><PARAM NAME="_cx" VALUE="5080"><PARAM NAME="_cy" VALUE="5080"><PARAM NAME="FlashVars" VALUE=""><PARAM NAME="Movie" VALUE="../upload/1228183070781_swf.swf"><PARAM NAME="Src" VALUE="../upload/1228183070781_swf.swf"><PARAM NAME="WMode" VALUE="Window"><PARAM NAME="Play" VALUE="-1"><PARAM NAME="Loop" VALUE="-1"><PARAM NAME="Quality" VALUE="High"><PARAM NAME="SAlign" VALUE=""><PARAM NAME="Menu" VALUE="-1"><PARAM NAME="Base" VALUE=""><PARAM NAME="AllowScriptAccess" VALUE=""><PARAM NAME="Scale" VALUE="ShowAll"><PARAM NAME="DeviceFont" VALUE="0"><PARAM NAME="EmbedMovie" VALUE="0"><PARAM NAME="BGColor" VALUE=""><PARAM NAME="SWRemote" VALUE=""><PARAM NAME="MovieData" VALUE=""><PARAM NAME="SeamlessTabbing" VALUE="1"><PARAM NAME="Profile" VALUE="0"><PARAM NAME="ProfileAddress" VALUE=""><PARAM NAME="ProfilePort" VALUE="0"><PARAM NAME="AllowNetworking" VALUE="all"><PARAM NAME="AllowFullScreen" VALUE="false">
<embed src=../upload/1228183070781_swf.swf 
pluginspage=<A>'</A>http://www.macromedia.com/go/getflashplayer<A>'</A> 
type=<A>'</A>application/x-shockwave-flash<A>'</A>  width=100% height=100%></embed></OBJECT>)</STRONG><BR><STRONG>1.&nbsp; 加入一个组</STRONG><BR>&nbsp;&nbsp;&nbsp; 一个主机或路由器能够加入一个组。每一个主机要维护一个有组内成员关系的进程表。当一个进程要加入到一个新组时，它就向主机发送请求。这个主机就在它的表中增加这个进程的名字和所请求的组的名字。如果所请求的组在表中不存在，这个主机就发送成员关系报告报文。如果所请求的组在表中已经存在，那就没有必要发送成员关系报告报文，因为这个主机已经是这个组的成员了，它已经开始接收发送给这个组的所有数据。<BR>&nbsp;&nbsp;&nbsp; 路由器也维护一个多播地址表，这个表给出了连接到每一个接口的成员关系。如果对于这些接口中的一个组有兴趣时，路由器就发送成员关系报告报文。这里的路由器就和主机一样，但它的组表的范围更大，因为它记录了连接在它的接口上的所有忠实成员。<BR>&nbsp;&nbsp;&nbsp; 下图给出了主机或路由器发送的成员关系报告。</P>
<P align=center><IMG src="../upload/1223624497609_pic.gif"></P>
<P align=center>图5-10&nbsp; 成员关系报告</P>
<P>&nbsp;&nbsp;&nbsp; IGMP协议要求把成员关系报告报文在很短的时间内发送两次。这样，如果第一个报文丢失或受到损伤，那么第二个报文可以代替它。<BR><STRONG>2.&nbsp; 退出一个组</STRONG><BR>&nbsp;&nbsp;&nbsp; 在IGMPv2中，当主机发现在一个特定组中已经没有感兴趣的进程，它就发送退出报告报文。同样地，当路由器发现在一个特定组中已经没有连接在它的接口上感兴趣的网络，它就发送退出这个组的报告。<BR>&nbsp;&nbsp;&nbsp; 但是，当多播路由器收到退出报告时，它并不能立即从它的表中清除这个组，因为这个退出报告仅仅是从一个主机或路由器发送来的，可能还有其它的主机或路由器仍然对这个组感兴趣。这时，这个路由器要发送一个特殊的查询报文，在这个报文中使用这个组的多播地址，并允许任何主机或路由器在指定的响应时间内回答。如果在这段时间内没有收到这个组的成员关系报告报文，这个路由器就认为在这个网络上没有忠实成员，因而就从表中清除这个组。<BR>&nbsp;&nbsp;&nbsp; 在IGMPv1和IGMPv3中，并没有退出报告报文，当使用IGMPv1和IGMPv3的主机要退出多播组时，它不发送任何报文。路由器会定期的发送查询报文，如果一段时间内路由器没有收到成员关系报告报文，那么路由器就清除这个组。<BR>&nbsp;&nbsp;&nbsp; 下图给出了IGMPv2的退出一个组的机制。</P>
<P align=center><IMG src="../upload/1238117948125_pic.gif"></P>
<P align=center>图5-11&nbsp; 退出报告</P>
<P><STRONG>七. 监视成员关系</STRONG><BR>&nbsp;&nbsp;&nbsp; 当仅有一台主机留在一个组中时，如果这台主机离开了这个组而没有发送退出报告报文，那么多播路由器将永远收不到退出报告报文，它认为这个组一直存在这个忠诚成员。为了解决这个问题，多播路由器应该负责监视局域网上的所有主机或路由器，以便知道它们是否愿意继续留在多播组中。<BR>&nbsp;&nbsp;&nbsp; 路由器周期性地（默认的间隔是每隔125s）发送一般查询报文。在这个报文中，组地址被置为0.0.0.0。<BR>&nbsp;&nbsp;&nbsp; 路由器期望着在它的组表中的每一个组的回答，甚至新的组也可以回答。查询报文的最大响应时间是10秒。当主机路由器收到一般查询报文时，如果它对一个组感兴趣，就发送成员关系报告报文。<BR><STRONG>1.&nbsp; 延迟响应<BR></STRONG>&nbsp;&nbsp;&nbsp; 为了避免不必要的通信量，IGMP使用延迟响应策略。当主机或路由器收到查询报文时，它不是立即响应，而是延迟响应。主机或路由器使用一个随机数产生计时器，它的截止时间是1～10秒。截止时间可以使用1秒或更短的步长。对表中的每一个组都设置计时器。例如，对第一组的计时器可以设截止时间为2秒，但对第三组的计时器则可设截止时间为5秒。每一个主机或路由器在发送成员关系报告报文之前都要等待它的计时器的时间。在这段等待时间中，如果在同一组中的其它主机或路由器的计时器先到了截止时间，那么这个主机或路由器就发送成员关系报告报文。因为这个报文是广播发送的，等待的主机或路由器都能收到这个报文，并知道没有必要对这个组发送重复的报文；因此，等待的主机或路由器就取消发送成员关系报告。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 