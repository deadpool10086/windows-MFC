<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">七.&nbsp;ISATAP隧道<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 使用ISATAP路由器<BR></td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>七.&nbsp;ISATAP隧道(
<OBJECT codeBase=http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0 classid=clsid:D27CDB6E-AE6D-11cf-96B8-444553540000><PARAM NAME="_cx" VALUE="5080"><PARAM NAME="_cy" VALUE="5080"><PARAM NAME="FlashVars" VALUE=""><PARAM NAME="Movie" VALUE="../upload/1228202401593_swf.swf"><PARAM NAME="Src" VALUE="../upload/1228202401593_swf.swf"><PARAM NAME="WMode" VALUE="Window"><PARAM NAME="Play" VALUE="-1"><PARAM NAME="Loop" VALUE="-1"><PARAM NAME="Quality" VALUE="High"><PARAM NAME="SAlign" VALUE=""><PARAM NAME="Menu" VALUE="-1"><PARAM NAME="Base" VALUE=""><PARAM NAME="AllowScriptAccess" VALUE=""><PARAM NAME="Scale" VALUE="ShowAll"><PARAM NAME="DeviceFont" VALUE="0"><PARAM NAME="EmbedMovie" VALUE="0"><PARAM NAME="BGColor" VALUE=""><PARAM NAME="SWRemote" VALUE=""><PARAM NAME="MovieData" VALUE=""><PARAM NAME="SeamlessTabbing" VALUE="1"><PARAM NAME="Profile" VALUE="0"><PARAM NAME="ProfileAddress" VALUE=""><PARAM NAME="ProfilePort" VALUE="0"><PARAM NAME="AllowNetworking" VALUE="all"><PARAM NAME="AllowFullScreen" VALUE="false">
<embed src=../upload/1228202401593_swf.swf 
pluginspage=<A>'</A>http://www.macromedia.com/go/getflashplayer<A>'</A> 
type=<A>'</A>application/x-shockwave-flash<A>'</A>  width=100% height=100%></embed></OBJECT>)</STRONG><BR>&nbsp;&nbsp;&nbsp; ISATAP是一种地址分配和主机到主机、主机到路由器和路由器到主机的自动隧道技术。它为IPv6主机之间提供了跨越IPv4内部网络单播IPv6连通性。ISATAP在题为“站间自动隧道寻址协议（ISATAP）”的Internet草案中讲述。ISATAP主机并不需要任何手工配置，它使用标准地址自动配置机制来创建ISATAP地址。<BR>&nbsp;&nbsp;&nbsp; ISATAP可用于IPv4网络中的IPv6/IPv4节点间的通信。ISATAP地址使用本地管理的接口标识符::0:5EFE:w.x.y.z，其中：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 0:5EFE部分是由Internet号码分配中心（IANA）所分配的机构单元标识符（00-00-5E）和表示内嵌的IPv4地址类型的类型号（FE）组合而成的。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; w.x.y.z部分是任意的单播IPv4地址，既可以是公共地址，也可以是私有地址。ISATAP接口标识符可以与任何有效的IPv6单播地址的64位前缀相结合。这包括链路本地地址前缀（FE80::/64）、站点本地前缀和全球前缀（包括6to4前缀）。<BR>&nbsp;&nbsp;&nbsp; 与IPv4映射地址、6over4地址和6to4地址相同，ISATAP地址中包含了一个内嵌的IPv4地址，当发往ISATAP地址的IPv6通信流通过隧道跨越了IPv4网络后，内嵌的IPv4地址可以用于确定IPv4报头中的源IPv4地址或目标IPv4地址。<BR>&nbsp;&nbsp;&nbsp; 例如，主机A的IPv4地址为10.40.1.29，主机B的IPv4地址为192.168.41.30。当IPv6协议启动后，主机A自动配置ISATAP地址FE80::5EFE:10.40.1.29，主机B自动配置ISATAP地址FE80::5EFE:192.168.41.30。配置的结果如下图7-11所示：</P>
<P align=center><IMG src="../upload/1223273557703_pic.gif"></P>
<P align=center>图7-11&nbsp; 一个ISATAP配置</P>
<P>&nbsp;&nbsp;&nbsp; 当主机A通过使用主机B的链路本地ISATAP地址将IPv6通信流发送给主机B时，在IPv6和IPv4报头中的源地址和目的地址如表7-3所示：</P>
<P align=center>表7-3&nbsp; IPv6和IPv4报头中的源地址和目的地址</P>
<P align=center><IMG src="../upload/1237267571015_pic.bmp"></P>
<P>&nbsp;&nbsp;&nbsp; 为测试连通性，可以使用ping命令。例如，主机A可以使用以下命令来ping主机B，命令中的地址是主机B的IPv4兼容地址：<BR>&nbsp;&nbsp;&nbsp; ping FE80::5EFE:192.168.41.30%2<BR>&nbsp;&nbsp;&nbsp; 由于ping命令的目标是链路本地地址，因此命令中的%区域ID部分用于表示发出通信流的接口的接口索引。在这种意义下，%2表示接口2，本例中它是主机A的自动隧道伪接口的接口索引。自动隧道伪接口将接口的链路本地ISATAP地址作为源地址，并且把源IPv6地址和目标IPv6地址中的最后32位（与内嵌的IPv4地址相对应的）用作源IPv4地址和目标IPv4地址。<BR><STRONG>1.&nbsp;使用ISATAP路由器<BR></STRONG>&nbsp;&nbsp;&nbsp; 链路本地ISATAP地址支持在同一个逻辑子网（一个IPv4网络）中的IPv6/IPv4主机之间的相互通信，但它并不支持这些主机与其它子网上的IPv6地址通信。为了让这些主机可以使用ISATAP全球地址或站点本地地址与逻辑子网之外的IPv6地址进行通信，IPv6主机必须将它们的数据包通过隧道发往一个ISATAP路由器。<BR>&nbsp;&nbsp;&nbsp; ISATAP路由器是一个IPv6路由器，它执行以下步骤：<BR>&nbsp;&nbsp;&nbsp; （1）在一个逻辑子网（一个IPv4网络）中的ISATAP主机与其它子网中的主机之间转发数据包。<BR>&nbsp;&nbsp;&nbsp; 这里的其它子网可以是其它IPv4网络（例如一个机构网络的一部分，或者IPv4 Internet），也可以是本地IPv6路由域中的子网（例如一个机构的IPv6网络，或者IPv6 Internet）。<BR>&nbsp;&nbsp;&nbsp; （2）用作ISATAP主机的默认路由器。<BR>&nbsp;&nbsp;&nbsp; 公告代表ISATAP主机所在的逻辑子网的地址前缀。ISATAP主机使用公告的地址前缀来配置站点本地地址和全球ISATAP地址。<BR>&nbsp;&nbsp;&nbsp; 当ISATAP主机从ISATAP路由器接收到路由器公告报文后，会使用自动隧道伪接口向自己的路由表中添加一条默认路由（::/0），默认路由中的下一跳地址的值为链路本地ISATAP地址。它对应于ISATAP路由器的逻辑子网接口。如果主机要发送的数据包的目的地址位于逻辑子网之外，则主机会将这些数据包通过隧道发往ISATAP路由器的IPv4地址。ISATAP路由器的IPv4地址对应于ISATAP路由器在逻辑子网的接口，这里的逻辑子网是包括ISATAP路由器和ISATAP主机的IPv4网络。然后ISATAP路由器就转发该IPv6数据包。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 