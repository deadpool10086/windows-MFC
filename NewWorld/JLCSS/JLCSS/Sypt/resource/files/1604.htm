<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">四.&nbsp;逐跳选项报头<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 逐跳选项报文格式与选项的结构<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 选项的类型<BR>五.&nbsp;路由报头<BR>六.&nbsp;分片报头</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>四.&nbsp;逐跳选项报头</STRONG><BR><STRONG>1.&nbsp; 逐跳选项报文格式与选项的结构<BR></STRONG>&nbsp;&nbsp;&nbsp; 逐跳选项头用于为通向目标路径上的每次跳转指定发送参数。如果IPv6的“下一个报头”域的值为0，则说明紧接着IPv6头的下一个报头是逐跳选项头。逐跳选项头的格式如图2-5所示：</P>
<P align=center><IMG src="../upload/1223261100593_pic.gif"></P>
<P align=center>图2-5&nbsp; 逐跳选项头的格式</P>
<P>&nbsp;&nbsp;&nbsp; 逐跳选项头结构中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 下一个报头：该字段长度为8位，定义在逐跳选项头之后的报头的类型。<BR>&nbsp;&nbsp;&nbsp; 长度：该字段是一个8位无符号整数，以8字节为单位表示逐跳选项头的长度，它不包括最初的8字节。<BR>&nbsp;&nbsp;&nbsp; 选项：选项是一系列字段的集合，它或者描述了数据包转发的一个方面的特性，或者用作填充。选项在逐跳选项报头和目的选项报头中发送。包含有一个或多个TLV编码的选项。选项的结构如图2-6所示：</P>
<P align=center><IMG src="../upload/1223261107281_pic.gif"></P>
<P align=center>图2-6&nbsp; 选项的结构</P>
<P>&nbsp;&nbsp;&nbsp; 选项结构中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 选项类型：选项类型字段既标识了这个选项，又确定了相关节点对该选项的处理方法。在选项类型字段中，最高的两位表示当处理选项的节点不能识别选项的类型时，应该如何处理这个选项：</P>
<P align=center>表2-2&nbsp; 不同选项类型的处理方法</P>
<P align=center><IMG src="../upload/1223261113828_pic.gif"></P>
<P>&nbsp;&nbsp;&nbsp; 选项类型字段的第三高位表示在通向目标的路径中，1表示选项数据可以改变，0表示选项数据不能改变。<BR>&nbsp;&nbsp;&nbsp; 选项长度：表示选项中的字节数，不包括选项类型和选项长度字段。<BR>&nbsp;&nbsp;&nbsp; 选项数据：与该选项相关的特定数据。<BR><STRONG>2.&nbsp; 选项的类型</STRONG><BR>&nbsp;&nbsp;&nbsp; 可能的选项有：Pad1选项、PadN选项、超大有效载荷选项、路由器警告选项。<BR>&nbsp;&nbsp;&nbsp; （1）Pad1选项：<BR>&nbsp;&nbsp;&nbsp; Pad1选项在RFC2460中定义，它的作用是插入一个填充字节，以使逐跳选项报头或目的选项报头能落在8字节的边界上，并符合选项的对齐要求。Pad1选项没有对齐要求。Pad1选项为一个字节，选项类型的值为0，它没有长度和值字段。<BR>&nbsp;&nbsp;&nbsp; （2）PadN选项：<BR>&nbsp;&nbsp;&nbsp; PadN选项的作用是插入两个或多个填充字节，以使逐跳选项报头或目的选项报头能落在8字节的边界上，并符合选项的对齐要求。PadN选项没有对齐要求。PadN选项中：类型字段的值为1；长度字段的值为当前所有的填充字节数；以及0个或多个填充字节。<BR>&nbsp;&nbsp;&nbsp; （3）超大有效载荷选项：<BR>&nbsp;&nbsp;&nbsp; 超大有效载荷选项表示有效载荷的长度大于65535字节。如果使用了超大有效载荷选项，则IPv6数据报的有效载荷的长度不再用IPv6报头中的有效载荷长度字段来表示，而是用超大有效载荷选项中的超大有效载荷长度字段来表示，单位为字节。超大有效载荷选项的结构如图2-7所示：</P>
<P align=center><IMG src="../upload/1223261120687_pic.gif"></P>
<P align=center>图2-7&nbsp; 超大有效载荷选项结构</P>
<P>&nbsp;&nbsp;&nbsp; （4）路由器警告选项：<BR>&nbsp;&nbsp;&nbsp; 路由器警告选项用于表示数据报的内容需要额外的处理。路由器警告选项用于多播侦听发现和资源存储协议。路由器警告选项的结构如图2-8所示：</P>
<P align=center><IMG src="../upload/1223261127187_pic.gif"></P>
<P align=center>图2-8&nbsp; 路由器警告选项结构</P>
<P><STRONG>五.&nbsp;路由报头</STRONG><BR>&nbsp;&nbsp;&nbsp; IPv6使用路由头列出数据包从源地址到目的地址之间将要访问的一个或多个中间节点。如果某一个头的“下一个报头”字段值为43，则说明紧接着它的下一个报头是路由头。路由头的格式如图2-9所示：</P>
<P align=center><IMG src="../upload/1223261133328_pic.gif"></P>
<P align=center>图2-9&nbsp; 路由报头结构</P>
<P>&nbsp;&nbsp;&nbsp; 在路由头结构中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 下一个报头：该字段长度为8位，定义紧接在路由头后的报头的类型。<BR>&nbsp;&nbsp;&nbsp; 长度：该字段为8位无符号整数，以8字节为单位标识路由头的长度，不包括最初的8字节。<BR>&nbsp;&nbsp;&nbsp; 路由类型：该字段长度为8位，标识不同类型的路由头。<BR>&nbsp;&nbsp;&nbsp; 剩余段：该字段为8位无符号整数，表示剩余的路由段的数量，即已经列出的在到达最终目的节点之前有待访问的中间节点数目。<BR>&nbsp;&nbsp;&nbsp; 路由特定类型字段：该域长度可变，格式由“路由类型”决定，长度应保证整个路由头的长度是8字节的整数倍。<BR>&nbsp;&nbsp;&nbsp; 当路由类型为0时，用于自由源路由。路由类型0报头的结构如图2-10所示：</P>
<P align=center><IMG src="../upload/1223261139765_pic.gif"></P>
<P align=center>图2-10&nbsp; 报头结构</P>
<P>&nbsp;&nbsp;&nbsp; 路由特定类型数据由一个32位的保留字段（该字段没有使用，设置为全0）和一个中间目的地址的列表组成，列表包括最终目的地址。数据包在最初发送时，目的地址的值为第一个中间目的地址，路由特定类型数据的值为其它中间目的地址及最终目的地址的列表。<BR>&nbsp;&nbsp;&nbsp; 当IPv6数据包到达一个中间目标时，路由报头会被处理，并且会执行以下步骤：<BR>&nbsp;&nbsp;&nbsp; （1）当前目的地址和地址列表中的第（N-剩余段+1）个地址相交换，这里N是路由报头中的地址总数。<BR>&nbsp;&nbsp;&nbsp; （2）剩余段的值减一。<BR>&nbsp;&nbsp;&nbsp; （3）数据包被转发。<BR>&nbsp;&nbsp;&nbsp; 当数据包到达最终目标的时候，剩余段的值被置为0，在到达目标的路径中所访问过的中间地址列表会被记录在路由报头中。<BR><STRONG>六.&nbsp;分片报头(
<OBJECT codeBase=http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0 classid=clsid:D27CDB6E-AE6D-11cf-96B8-444553540000><PARAM NAME="_cx" VALUE="5080"><PARAM NAME="_cy" VALUE="5080"><PARAM NAME="FlashVars" VALUE=""><PARAM NAME="Movie" VALUE="../upload/1228201226156_swf.swf"><PARAM NAME="Src" VALUE="../upload/1228201226156_swf.swf"><PARAM NAME="WMode" VALUE="Window"><PARAM NAME="Play" VALUE="-1"><PARAM NAME="Loop" VALUE="-1"><PARAM NAME="Quality" VALUE="High"><PARAM NAME="SAlign" VALUE=""><PARAM NAME="Menu" VALUE="-1"><PARAM NAME="Base" VALUE=""><PARAM NAME="AllowScriptAccess" VALUE=""><PARAM NAME="Scale" VALUE="ShowAll"><PARAM NAME="DeviceFont" VALUE="0"><PARAM NAME="EmbedMovie" VALUE="0"><PARAM NAME="BGColor" VALUE=""><PARAM NAME="SWRemote" VALUE=""><PARAM NAME="MovieData" VALUE=""><PARAM NAME="SeamlessTabbing" VALUE="1"><PARAM NAME="Profile" VALUE="0"><PARAM NAME="ProfileAddress" VALUE=""><PARAM NAME="ProfilePort" VALUE="0"><PARAM NAME="AllowNetworking" VALUE="all"><PARAM NAME="AllowFullScreen" VALUE="false">
<embed src=../upload/1228201226156_swf.swf 
pluginspage=<A>'</A>http://www.macromedia.com/go/getflashplayer<A>'</A> 
type=<A>'</A>application/x-shockwave-flash<A>'</A>  width=100% 
height=100%></embed></OBJECT>)</STRONG><BR>&nbsp;&nbsp;&nbsp; IPv6源节点使用分片头来发送数据包长度比路径MTU大的数据包（与IPv4不同，IPv6的分片由源节点完成，而不是由数据包发送路径上的路由器完成）。如果一个头的“下一个报头”字段的值为44，则说明紧接在它后面的一个头是分片头。分片头的格式如图2-11所示：</P>
<P align=center><IMG src="../upload/1223261147015_pic.gif"></P>
<P align=center>图2-11&nbsp; 分片报头</P>
<P>&nbsp;&nbsp;&nbsp; 分片报头结构中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 下一个报头：该字段长度为8位，定义紧接在分片报头之后的报头的类型。<BR>&nbsp;&nbsp;&nbsp; 保留：该字段长度为8位，传输时初始值设为0，接收方忽略此字段。<BR>&nbsp;&nbsp;&nbsp; 分片偏移量：该字段长度为13位，以8字节为单位，表示该头后面的数据相对于初始数据包可分片部分的起始位置数据的偏移量。<BR>&nbsp;&nbsp;&nbsp; 分片未完标志：该字段长度为1位，为1时表示还有更多的分片，为0时表示这是最后一片。<BR>&nbsp;&nbsp;&nbsp; 标识：该字段长度为32位。源节点为每个要分片的数据包生成一个标识值。该标识值必须不同于从相同源地址到相同目的地址的“最近”发出的任何其它数据包的标识值，如果有路由头存在，则上述目的地址指的是最终目的地址。“最近”是指在一个包的最大可能生存时间内，包括从源到目的地的传输时间和等待同一个数据包的其它分片重新组装的时间。<BR>&nbsp;&nbsp;&nbsp; 在对一个IPv6原始数据包进行拆分时，首先要将数据包划分为可拆分部分和不可拆分部分。原始数据包是指最初的，没有分片的数据包。不可分片部分包括IPv6头及其它必须被所达目的地路径上所有节点处理的头如：逐跳选项头、路由头、中间目的选项头。可分片部分包括该数据包余下的部分，其中包括身份验证报头、ESP报头、最终目的选项头、上层头和数据。原始数据包的可分片部分被分成片段，除了最后一个片段外，每个片段的长度都应是8字节的整数倍。每个分片包的组成如下：<BR>&nbsp;&nbsp;&nbsp; <SPAN lang=EN-US style="FONT-SIZE: 10.5pt; FONT-FAMILY: 宋体; mso-bidi-font-size: 11.0pt; mso-bidi-font-family: <A>'</A>Times New Roman<A>'</A>; mso-font-kerning: 1.0pt; mso-ansi-language: EN-US; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA">●<SPAN style="mso-spacerun: yes">&nbsp; </SPAN></SPAN>源数据包不可分片部分；<BR>&nbsp;&nbsp;&nbsp; <SPAN lang=EN-US style="FONT-SIZE: 10.5pt; FONT-FAMILY: 宋体; mso-bidi-font-size: 11.0pt; mso-bidi-font-family: <A>'</A>Times New Roman<A>'</A>; mso-font-kerning: 1.0pt; mso-ansi-language: EN-US; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA">●<SPAN style="mso-spacerun: yes">&nbsp; </SPAN></SPAN>分片头部分：包括下一个报头（标识原始数据包可分片部分的第一个头），分片偏移量（以8字节为单位表示分片相对于原始数据包可分片部分开始位置的偏移量，第一个分片的分片偏移量值为0），分片未完标志，标识（用来标识原始数据包）；<BR>&nbsp;&nbsp;&nbsp; <SPAN lang=EN-US style="FONT-SIZE: 10.5pt; FONT-FAMILY: 宋体; mso-bidi-font-size: 11.0pt; mso-bidi-font-family: <A>'</A>Times New Roman<A>'</A>; mso-font-kerning: 1.0pt; mso-ansi-language: EN-US; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA">●<SPAN style="mso-spacerun: yes">&nbsp; </SPAN></SPAN>分片本身。<BR>&nbsp;&nbsp;&nbsp; IPv6使用IPv6中的源地址和目的地址字段，以及分片报头中的标识字段，分片未完标志字段和分片偏移量字段对分片数据进行重组。目标节点会计算原始有效载荷的长度，并更新重组的数据包中的IPv6报头的有效载荷长度字段的值。另外，在数据包的不可拆分部分中，最后一个报头的下一个报头字段的值被置为第一个分片的分片头中的下一个报头字段的值。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 