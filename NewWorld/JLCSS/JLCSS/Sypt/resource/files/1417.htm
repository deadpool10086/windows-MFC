<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">四. DNS报文格式</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>四. DNS报文格式</STRONG><BR>&nbsp;&nbsp;&nbsp; DNS报文由12字节长的首部和4个长度可变的字段组成，如下图所示：</P>
<P align=center><IMG src="../upload/1223254422546_pic.gif"></P>
<P align=center>图11-7&nbsp; DNS报文格式</P>
<P>&nbsp;&nbsp;&nbsp; （1）标识：该字段占两个字节，由客户程序设置并由服务器返回。客户程序通过它来确定响应与查询是否匹配。<BR>&nbsp;&nbsp;&nbsp; （2）标志：16位的标志字段被划分为若干子字段，如下图所示：</P>
<P align=center><IMG src="../upload/1223254429171_pic.gif"></P>
<P align=center>图11-8&nbsp; DNS标志字段</P>
<P>&nbsp;&nbsp;&nbsp; 标志字段的各子字段含义如下：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; QR（查询/响应）：该位为0时是查询报文；为1时是响应报文。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; Opcode：该位为0时是标准查询；为1时是反向查询；为2时是服务器状态请求。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; AA（授权回答）：这是1位字段。当它设置为1时，表示名字服务器是权限服务器。它只用在响应报文中有效。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; TC（截断的）：该位只在响应报文中有效，它表示响应报文被切割，因为响应报文过大而无法适用于数据包的数据部分。例如，如果响应包含大量名称服务器，数据包可能会超过允许的MTU。这时，数据包将被切割，并且将TC域位设置为1。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; RD（要求递归）：如果目标名称服务器不包含所请求的信息，该域表示客户端请求递归查询。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; RA（递归可用）：该域在响应中有效，它表示响应名称服务器是否提供递归查询。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; AD（可信数据）：这位用来指定所有的数据已经被服务器认证。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; CD（验证无效）：这位指定了没有被认证的数据对于询问者来说是可以接受的。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; Rcode：该域长度为4位，用于DNS响应中，表示是否出现错误。<BR>&nbsp;&nbsp;&nbsp; （3）问题记录数：该字段占两个字节，查询问题部分包含的条目数量。<BR>&nbsp;&nbsp;&nbsp; （4）应答记录数：该字段占两个字节，表示回答部分包含的回答记录数。在查询报文中它的值是0。<BR>&nbsp;&nbsp;&nbsp; （5）授权记录数：该字段占两个字节，包含在响应报文的授权部分的授权记录数。在查询报文中它的值是0。<BR>&nbsp;&nbsp;&nbsp; （6）附加记录数：该字段占两个字节，包含在响应报文的附加部分的附加记录数。在查询报文中它的值是0。<BR>&nbsp;&nbsp;&nbsp; （7）查询问题：DNS查询或响应报文中会有查询部分。查询部分中每个问题的格式如下图所示：</P>
<P align=center><IMG src="../upload/1223254438453_pic.gif"></P>
<P align=center>图11-9&nbsp; DNS查询问题字段</P>
<P>&nbsp;&nbsp;&nbsp; ●&nbsp; 查询名：表示要查找的名字，它是一个或多个标识符序列。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 查询类型：表示查询问题时的类型。最常用的查询类型是A类型，表示期望获得查询名的IP地址；而一个PTR查询则请求获得一个IP地址对应的域名。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 查询类：表示查询的类别。其值通常是1，表示Internet类型。<BR>&nbsp;&nbsp;&nbsp; （8）回答（资源记录数可变）：DNS响应报文中会有回答部分。回答部分包括从服务器到客户（解析程序）的回答。其资源记录的格式如下图所示：</P>
<P align=center><IMG src="../upload/1223254447281_pic.gif"></P>
<P align=center>图11-10&nbsp; DNS回答字段</P>
<P>&nbsp;&nbsp;&nbsp; ●&nbsp; 域名：表示记录中资源数据对应的名字。它的格式和查询名字字段格式相同。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 类型：表示资源记录的类型。它的值和查询类型的值是一样的。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 类：表示资源记录的类别。它的值和查询类的值是一样的。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 生存时间：表示客户程序保留该资源记录的秒数。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 资源数据长度：表示资源数据的数量。该数据的格式依赖于类型字段的值。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 资源数据：表示该资源数据的内容。<BR>&nbsp;&nbsp;&nbsp; （9）授权（资源记录数可变）：DNS响应报文中会有授权部分。授权部分为该查询给出关于一个或多个授权服务器的信息（域名）。其资源记录的格式如下图所示：</P>
<P align=center><IMG src="../upload/1223254454281_pic.gif"></P>
<P align=center>图11-11&nbsp; DNS授权字段</P>
<P>&nbsp;&nbsp;&nbsp; ●&nbsp; 域名：表示记录中资源数据对应的名字。它的格式和查询名字字段格式相同。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 类型：表示资源记录的类型。它的值和查询类型的值是一样的。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 类：表示资源记录的类别。它的值和查询类的值是一样的<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 生存时间：表示客户程序保留该资源记录的秒数。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 资源数据长度：表示资源数据的数量。该数据的格式依赖于类型字段的值<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 资源数据：表示该资源数据的内容。<BR>&nbsp;&nbsp;&nbsp; （10）额外信息（资源记录数可变）：DNS响应报文中会有额外信息部分。额外信息部分提供有助于解析程序的附加信息。其资源记录格式如下图所示：</P>
<P align=center><IMG src="../upload/1223254461375_pic.gif"></P>
<P align=center>图11-12&nbsp; DNS额外信息字段</P>
<P>&nbsp;&nbsp;&nbsp; ●&nbsp; 域名：表示记录中资源数据对应的名字。它的格式和查询名字段格式相同。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 类型：表示资源记录的类型。它的值和查询类型的值是一样的。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 类：表示资源记录的类别。它的值和查询类的值是一样的。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 生存时间：表示客户程序保留该资源记录的秒数。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 资源数据长度：表示资源数据的数量。该数据的格式依赖于类型字段的值。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 资源数据：表示该资源数据的内容。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 