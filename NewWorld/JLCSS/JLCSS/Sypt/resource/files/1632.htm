<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">四.&nbsp;IPv6穿越IPv4的隧道<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 路由器到路由器<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 主机到路由器和路由器到主机<BR>&nbsp;&nbsp;&nbsp; 3.&nbsp; 主机到主机</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>四. IPv6穿越IPv4的隧道()</STRONG><BR>&nbsp;&nbsp;&nbsp; IPv6穿越IPv4（IPv6overIPv4
<OBJECT codeBase=http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0 classid=clsid:D27CDB6E-AE6D-11cf-96B8-444553540000><PARAM NAME="_cx" VALUE="5080"><PARAM NAME="_cy" VALUE="5080"><PARAM NAME="FlashVars" VALUE=""><PARAM NAME="Movie" VALUE="../upload/1238377563968_swf.swf"><PARAM NAME="Src" VALUE="../upload/1238377563968_swf.swf"><PARAM NAME="WMode" VALUE="Window"><PARAM NAME="Play" VALUE="-1"><PARAM NAME="Loop" VALUE="-1"><PARAM NAME="Quality" VALUE="High"><PARAM NAME="SAlign" VALUE=""><PARAM NAME="Menu" VALUE="-1"><PARAM NAME="Base" VALUE=""><PARAM NAME="AllowScriptAccess" VALUE=""><PARAM NAME="Scale" VALUE="ShowAll"><PARAM NAME="DeviceFont" VALUE="0"><PARAM NAME="EmbedMovie" VALUE="0"><PARAM NAME="BGColor" VALUE=""><PARAM NAME="SWRemote" VALUE=""><PARAM NAME="MovieData" VALUE=""><PARAM NAME="SeamlessTabbing" VALUE="1"><PARAM NAME="Profile" VALUE="0"><PARAM NAME="ProfileAddress" VALUE=""><PARAM NAME="ProfilePort" VALUE="0"><PARAM NAME="AllowNetworking" VALUE="all"><PARAM NAME="AllowFullScreen" VALUE="false">
<embed src=../upload/1238377563968_swf.swf 
pluginspage=<A>'</A>http://www.macromedia.com/go/getflashplayer<A>'</A> 
type=<A>'</A>application/x-shockwave-flash<A>'</A>  width=100% height=100%></embed></OBJECT>）的隧道，是指用IPv4报头来封装IPv6数据包，以使IPv6数据包可以穿越IPv4的网络结构。在IPv4报头中，IPv4协议字段的值为41，表示这是一个经过封装的IPv6数据包。源地址和目的地址字段的值为隧道端点的IPv4地址。隧道端点一般是手工配置的隧道接口的一部分，或者是从发送接口自动获得的与路由相匹配的下一跳地址，或者是IPv6报头中的源IPv6地址或目标IPv6地址。<BR>&nbsp;&nbsp;&nbsp; 对于IPv6穿越IPv4的隧道，到目标的IPv6路经MTU通常比到目标的IPv4路经MTU小20。然而，如果IPv4路经MTU没有在每个隧道中保存，则在一些情况下，IPv4数据包将需要被中间路由器拆分。在这种情况下，经过IPv6穿越IPv4隧道的数据包，必须在发送时将IPv4报头中的不拆分标志置为0。</P>
<P align=center><IMG src="../upload/1223273398171_pic.gif"></P>
<P align=center>图7-4&nbsp; IPv6穿越IPv4的隧道机制</P>
<P><STRONG>1.&nbsp;路由器到路由器</STRONG><BR>&nbsp;&nbsp;&nbsp; 在路由器到路由器的隧道配置中，两个IP网络结构（IPv4，IPv6，或者两者的混合）是由两台IPv6/IPv4路由器通过IPv4网络连接起来的。隧道的端点跨越了位于源节点和目标节点之间的路径中的一条逻辑链路。两个路由器之间的IPv6穿越IPv4隧道用作一个单跳。在每个IPv4或IPv6网络中的路由器指向边界上的IPv6/IPv4路由器。在每个IPv6/IPv4路由器上，都有一个表示IPv6穿越IPv4隧道的隧道接口，以及一些使用隧道接口的路由。<BR>路由器到路由器的隧道机制如下图7-5所示：</P>
<P align=center><IMG src="../upload/1223273405703_pic.gif"></P>
<P align=center>图7-5&nbsp; 路由器到路由器的隧道机制</P>
<P>&nbsp;&nbsp;&nbsp; 这种隧道配置的例子有：<BR>&nbsp;&nbsp;&nbsp; （1）&nbsp;一个仅支持IPv6的测试实验室通过隧道来跨越一个机构的IPv4网络，以到达IPv6的Internet。<BR>&nbsp;&nbsp;&nbsp; （2）&nbsp;两个仅支持IPv6的网络通过隧道来穿过IPv4的Internet。<BR>&nbsp;&nbsp;&nbsp; （3）一个6to4路由器通过隧道来穿越IPv4的Internet，以到达另一个6to4路由器，或者6to4中继路由器。<BR><STRONG>2.&nbsp;主机到路由器和路由器到主机</STRONG><BR>&nbsp;&nbsp;&nbsp; 在从主机到路由器的隧道配置中，由IPv4网络中的IPv6/IPv4节点创建一个IPv6穿越IPv4的隧道，以到达IPv6/IPv4路由器。隧道端点跨越了在源节点和目标节点之间的路径上的第一段。在IPv6/IPv4节点和IPv6/IPv4路由器之间的IPv6穿越IPv4隧道用作一个单跳。<BR>&nbsp;&nbsp;&nbsp; IPv6/IPv4节点会在其上创建一个表示IPv6穿越IPv4隧道的隧道接口，并使用隧道接口向自己的路由表中加一条路由（通常是一条默认路由）。IPv6/IPv4节点根据相匹配的路由，隧道接口以及IPv6/IPv4路由器的下一跳地址来为IPv6数据包建立隧道。<BR>&nbsp;&nbsp;&nbsp; 在从路由器到主机的隧道配置中，由IPv6/IPv4路由器创建一个IPv6穿越IPv4的隧道，以跨越IPv4网络，到达IPv6/IPv4节点。隧道端点跨越了在源节点和目标节点之间的路径上的最后一段。在IPv6/IPv4路由器和IPv6/IPv4节点之间的IPv6穿越IPv4隧道用作一个单跳。<BR>&nbsp;&nbsp;&nbsp; IPv6/IPv4路由器会在其上创建一个表示IPv6穿越IPv4隧道的隧道接口，并使用隧道接口向自己的路由表中添加一条路由（通常是默认路由）。IPv6/IPv4节点根据相匹配的子网路由，隧道接口以及IPv6/IPv4节点的目的地址来为IPv6数据包建立隧道。<BR>&nbsp;&nbsp;&nbsp; 图7-6显示了从主机到路由器和从路由器到主机的隧道机制</P>
<P align=center><IMG src="../upload/1223273455218_pic.gif"></P>
<P align=center>图7-6&nbsp; 从主机到路由器和从路由器到主机隧道机制</P>
<P>&nbsp;&nbsp;&nbsp; 这种隧道配置的例子有：<BR>&nbsp;&nbsp;&nbsp; （1）&nbsp;一个IPv6/IPv4主机通过隧道来跨越一个机构的IPv4网络，以到达IPv6的Internet（主机到路由器隧道配置）。<BR>&nbsp;&nbsp;&nbsp; （2）&nbsp;一个ISATAP主机通过隧道来跨越一个IPv4网络到达一个ISATAP路由器，以到达IPv4的Internet，另一个IPv4网络或一个IPv6网络（主机到路由器隧道配置）。<BR>&nbsp;&nbsp;&nbsp; （3）&nbsp;一个ISATAP路由器通过一个隧道来跨越一个IPv4网络到达一个ISATAP主机（路由器到主机隧道配置）。<BR><STRONG>3.&nbsp;主机到主机</STRONG><BR>&nbsp;&nbsp;&nbsp; 在主机到主机的隧道配置中，由IPv4网络中的IPv6/IPv4节点创建一个IPv6穿越IPv4的隧道，以到达位于同一IPv4网络中的另一个IPv6/IPv4节点。隧道端点跨越了在源节点和目标节点之间的整个路径。在IPv6/IPv4节点之间的IPv6穿越IPv4隧道用作一个单跳。<BR>&nbsp;&nbsp;&nbsp; 每个IPv6/IPv4节点会在其上创建一个表示IPv6穿越IPv4隧道的接口。在此过程中需要使用路由来指示目标节点位于IPv4网络所定义的相同的逻辑子网中。源主机根据源接口，可选路由和目的地址，通过隧道将IPv6通信流发往目标。<BR>&nbsp;&nbsp;&nbsp; 主机到主机的隧道如下图7-7所示：</P>
<P align=center><IMG src="../upload/1223273463687_pic.gif"><BR>图7-7&nbsp; 主机到主机隧道</P>
<P align=left>&nbsp;&nbsp;&nbsp; 这种隧道配置的例子有：<BR>&nbsp;&nbsp;&nbsp; （1）&nbsp;使用ISATAP地址的IPv6/IPv4主机，通过隧道来跨越一个机构的IPv4网络结构。<BR>&nbsp;&nbsp;&nbsp; （2）&nbsp;使用IPv4兼容地址的IPv6/IPv4主机，通过隧道来跨越一个机构的IPv4网络结构。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 