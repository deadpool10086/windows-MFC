<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">六. UDP校验和<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 在发送端的校验和计算<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 在接收端的校验和计算<BR>七. UDP应用</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>六. UDP校验和<BR></STRONG>&nbsp;&nbsp;&nbsp; UDP校验和的计算与IP和ICMP校验和的计算不同。UDP校验和校验的范围包括三部分：伪首部、UDP首部以及从应用层来的数据。<BR>&nbsp;&nbsp;&nbsp; 伪首部是IP首部的一部分，其中有些字段要填入0。用户数据报封装在IP数据包中。如下图所示：</P>
<P align=center><IMG src="../upload/1223624556781_pic.gif"></P>
<P align=center>图6-4&nbsp; 伪首部添加在UDP数据报上</P>
<P>&nbsp;&nbsp;&nbsp; 若校验和不包括伪首部，用户数据报也可能是安全的和正确的。但是，若IP首部受到损伤，则它可能被交付到错误的主机。<BR>&nbsp;&nbsp;&nbsp; 伪首部中包含高层协议类型字段是为了确保这个数据包是属于UDP而不是属于TCP（参见实验七）的。使用UDP的进程和使用TCP的进程可以使用同一个端口号。UDP的高层协议类型字段是17。若在传输过程中这个值改变了，在接收端计算校验和时就可检测出来，UDP就可丢弃这个数据包。这样就不会交付给错误的协议。<BR><STRONG>1.&nbsp; 在发送端的校验和计算</STRONG><BR>&nbsp;&nbsp;&nbsp; 在发送端按以下步骤计算校验和：<BR>&nbsp;&nbsp;&nbsp; （1）把伪首部填加到UDP用户数据报上。<BR>&nbsp;&nbsp;&nbsp; （2）把校验和字段填入零。<BR>&nbsp;&nbsp;&nbsp; （3）按16位长度将数据报分段。<BR>&nbsp;&nbsp;&nbsp; （4）若分段总数不是偶数，则增加一个分段的填充（全0）。填充只是为了计算校验和，计算完毕后就把它丢弃。<BR>&nbsp;&nbsp;&nbsp; （5）把所有16位的分段使用反码算术运算相加。<BR>&nbsp;&nbsp;&nbsp; （6）把得到的结果取反码，它是一个16位的数，把这个数插入到校验和字段。<BR>&nbsp;&nbsp;&nbsp; （7）把伪首部和填充丢掉。<BR>&nbsp;&nbsp;&nbsp; （8）把UDP用户数据报交付给IP进行封装。<BR>&nbsp;&nbsp;&nbsp; 在伪首部中的各行的顺序对校验和的计算没有任何影响。此外，增加0也不影响计算的结果。<BR>&nbsp;&nbsp;&nbsp; 下图给出了一个计算UDP校验和的例子。这里假定用户数据报的长度是15字节，因此要添加一个全0的字节。</P>
<P align=center><IMG src="../upload/1223624566140_pic.gif"></P>
<P align=center>图6-5&nbsp; UDP校验和的计算过程</P>
<P><STRONG>2.&nbsp; 在接收端的校验和计算</STRONG><BR>&nbsp;&nbsp;&nbsp; 接收端按以下6个步骤计算校验和是否正确：<BR>&nbsp;&nbsp;&nbsp; （1）把伪首部加到UDP用户数据报上。<BR>&nbsp;&nbsp;&nbsp; （2）若需要，就增加填充。<BR>&nbsp;&nbsp;&nbsp; （3）把数据报按16位长度分段。<BR>&nbsp;&nbsp;&nbsp; （4）把所有16位的分段使用反码算术运算相加。<BR>&nbsp;&nbsp;&nbsp; （5）把得到的结果取反码。<BR>&nbsp;&nbsp;&nbsp; （6）若得到的结果是全零，则丢弃首部和填充，并接受这个用户数据报。若结果是非零，就丢弃这个用户数据报。<BR>&nbsp;&nbsp;&nbsp; 校验和是可选使用的，若不计算校验和，则校验和字段就填入0。<BR><STRONG>七. UDP应用</STRONG><BR>&nbsp;&nbsp;&nbsp; 下面列出了UDP协议的一些用途：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; UDP适用于这样的进程，它需要简单的请求――响应通信，而较少考虑流量控制和差错控制。对于需要传送成块数据的进程，如FTP，则通常不使用UDP；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; UDP适用于具有内部流量控制和差错控制机制的进程；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 对多播和广播来说，UDP是个比较合适的传输层协议；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; UDP可用于管理进程，如SNMP协议；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; UDP可用于某些路由选择更新协议，如路由信息协议（RIP协议，参考实验17）。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 