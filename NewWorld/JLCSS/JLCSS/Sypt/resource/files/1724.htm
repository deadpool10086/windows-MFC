<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P>一.&nbsp;邻居发现协议简介<BR>二.&nbsp;邻居发现报文格式<BR>&nbsp;&nbsp;&nbsp; 1. &nbsp;邻节点发现报文格式<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 邻节点发现选项<BR></P></td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>一.&nbsp;邻居发现协议简介<BR></STRONG>&nbsp;&nbsp;&nbsp; 邻居发现协议是IPv6协议的一个重要组成部分，它解决连接在同一链路上的节点之间的交互问题。邻居发现（ND）过程，是用一系列的报文和步骤来确定邻节点之间关系的过程。邻居发现取代了IPv4中使用的ARP、ICMP路由器发现和ICMP重定向报文。邻居发现协议确定了路由器发现、前缀发现、参数发现、地址自动配置、地址解析、下一跳确定、邻居不可达检测、地址重复检测、重定向等问题的解决方案。<BR><STRONG>二.&nbsp;邻居发现报文格式</STRONG><BR><STRONG>1.&nbsp;邻节点发现报文格式<BR></STRONG>&nbsp;&nbsp;&nbsp; 邻居发现使用ICMPv6报文结构，报文类型字段的值从133到137。邻居发现报文由邻节点发现报文头和0个或多个邻居发现报文选项组成。其中邻居发现报文头由ICMPv6报头和ND（邻居发现）报文的特定数据构成。ND报文的格式如图5-1所示：</P>
<P align=center><IMG src="../upload/1225262861281_pic.gif"></P>
<P align=center>图5-1&nbsp; 邻节点发现报文的格式</P>
<P>&nbsp;&nbsp;&nbsp; 有5种不同的邻节点发现报文：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 路由器请求报文（ICMPv6类型为133）；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 路由器公告报文（ICMPv6类型为134）；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 邻节点请求报文（ICMPv6类型为135）；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 邻节点公告报文（ICMPv6类型为136）；<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 重定向报文（ICMPv6类型为137）。<BR>&nbsp;&nbsp;&nbsp; 为了确保收到的邻居发现报文发自本地链路上的节点，发送方将其发出的所有邻居发现报文中的跳限制字段的值都置为255。当接收方收到一个邻居发现报文时，它会首先检查IPv6报头中的跳限制字段。如果此字段的值不等于255，就丢弃该报文。<BR><STRONG>2.&nbsp;邻节点发现选项</STRONG><BR>&nbsp;&nbsp;&nbsp; 邻居发现报文选项提供了附加的信息、这些信息用于表示MAC地址、链路上的网络前缀、链路上的MTU信息、重定向数据、移动信息和特定的路由。常用的邻居发现选项有：源链路层选项和目标链路层选项、前缀信息选项、重定向报头选项、MTU报头选项、公告间隔选项、本地代理信息选项和路由信息选项<BR>&nbsp;&nbsp;&nbsp; （1）源链路层选项<BR>&nbsp;&nbsp;&nbsp; 源链路层地址选项表示邻居发现报文的发送方的链路层地址，用于邻居请求，路由器请求和路由器公告报文中。源链路层地址选项的格式如图5-2所示：</P>
<P align=center><IMG src="../upload/1223270678359_pic.gif"></P>
<P align=center>图5-2&nbsp; 源链路层地址选项格式</P>
<P>&nbsp;&nbsp;&nbsp; 源链路层选项中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：源链路层选项类型为1。<BR>&nbsp;&nbsp;&nbsp; 长度：8字节的整数倍。<BR>&nbsp;&nbsp;&nbsp; （2）目标链路层选项<BR>&nbsp;&nbsp;&nbsp; 目标链路层地址选项表示IPv6数据包应发送到的邻节点的链路层地址，用于邻居公告和重定向报文。目标链路层地址选项的格式如图5-3所示：</P>
<P align=center><IMG src="../upload/1223270728859_pic.gif"></P>
<P align=center>图5-3&nbsp; 目标链路层地址选项格式</P>
<P>&nbsp;&nbsp;&nbsp; 目标链路层选项中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：目标链路层选项类型为2。<BR>&nbsp;&nbsp;&nbsp; 长度：8字节的整数倍。<BR>&nbsp;&nbsp;&nbsp; （3）前缀信息选项<BR>&nbsp;&nbsp;&nbsp; 前缀信息选项用于路由器公告报文，表示地址前缀和有关地址自动配置的信息。前缀信息选项的格式如图5-4所示：</P>
<P align=center><IMG src="../upload/1223270735515_pic.gif"></P>
<P align=center>图5-4&nbsp; 前缀信息选项格式</P>
<P>&nbsp;&nbsp;&nbsp; 前缀信息选项报文各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：前缀信息选项类型为3。<BR>&nbsp;&nbsp;&nbsp; 长度：前缀信息选项长度为4。<BR>&nbsp;&nbsp;&nbsp; 前缀长度：前缀长度字段表示在包含地址前缀的前缀字段中的地址前缀位数。<BR>&nbsp;&nbsp;&nbsp; 在链路上标志：当为1时，表示由选项中的地址前缀所暗示的地址在链路上是有效的。<BR>&nbsp;&nbsp;&nbsp; 自治标志：为1时，表示选项中的前缀用于创建一个自治的（或无状态的）地址配置。<BR>&nbsp;&nbsp;&nbsp; 路由器地址标志：为1时，表示前缀字段中也包含了分配给发送路由器公告报文的路由器的IPv6地址。<BR>&nbsp;&nbsp;&nbsp; 站点前缀标志：为1时，表示使用前缀字段和由站点前缀长度字段定义的站点前缀来更新站点前缀表。<BR>&nbsp;&nbsp;&nbsp; 有效生存期：表示一个地址处于有效状态的时间（秒数）。<BR>&nbsp;&nbsp;&nbsp; 优先生存期：表示一个地址处于优先状态的时间（秒数）。<BR>&nbsp;&nbsp;&nbsp; 保留：24位全0。<BR>&nbsp;&nbsp;&nbsp; 站点前缀长度：表示在定义了站点前缀的前缀字段中的站点前缀的位数。<BR>&nbsp;&nbsp;&nbsp; 前缀：表示通过无状态地址自动配置协议产生的IPv6地址的前缀。<BR>&nbsp;&nbsp;&nbsp; （4）重定向报头选项<BR>&nbsp;&nbsp;&nbsp; 重定向报头选项用于重定向报文中，它指定导致路由器重定向报文的IPv6数据包。重定向报头选项的格式如图5-5所示：</P>
<P align=center><IMG src="../upload/1223270742625_pic.gif"></P>
<P align=center>图5-5&nbsp; 重定向报头选项</P>
<P>&nbsp;&nbsp;&nbsp; 重定向报头选项中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：重定向报头选项类型为4。<BR>&nbsp;&nbsp;&nbsp; 长度：8字节的块数。<BR>&nbsp;&nbsp;&nbsp; 保留：48位，所有位都为0。<BR>&nbsp;&nbsp;&nbsp; 重定向数据包部分：存放导致路由器发送重定向报文的全部或部分IPv6数据包。<BR>&nbsp;&nbsp;&nbsp; （5）MTU报头选项<BR>&nbsp;&nbsp;&nbsp; MTU选项用于路由器公告报文，它表示链路的IPv6 MTU。MTU选项的格式如图5-6所示：</P>
<P align=center><IMG src="../upload/1223270749734_pic.gif"></P>
<P align=center>图5-6&nbsp; MTU报头选项</P>
<P>&nbsp;&nbsp;&nbsp; MTU报头选项中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：MTU报头选项类型为5。<BR>&nbsp;&nbsp;&nbsp; 长度：MTU报头选项长度为1。<BR>&nbsp;&nbsp;&nbsp; 保留：16位，都为0。<BR>&nbsp;&nbsp;&nbsp; MTU：表示主机所应该使用的IPv6链路MTU。<BR>&nbsp;&nbsp;&nbsp; （6）公告间隔选项<BR>&nbsp;&nbsp;&nbsp; 公告间隔选项用于路由器公告报文，它规定了路由器（作为本地代理）发送自发的多播路由器公告报文的时间间隔。公告间隔选项的格式如图5-7所示：</P>
<P align=center><IMG src="../upload/1223270756640_pic.gif"></P>
<P align=center>图5-7&nbsp; 公告间隔选项格式</P>
<P>&nbsp;&nbsp;&nbsp; 公告间隔选项中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：公告间隔选项类型为7。<BR>&nbsp;&nbsp;&nbsp; 长度：公告间隔选项长度为1。<BR>&nbsp;&nbsp;&nbsp; 保留：保留字段留作将来使用，其长度为16位，且所有位都置为0。<BR>&nbsp;&nbsp;&nbsp; 公告间隔：公告间隔规定了本地代理所连续发送的自发的多播路由器公告报文间的最大时间间隔，单位为毫秒。<BR>&nbsp;&nbsp;&nbsp; （7）本地代理信息选项<BR>&nbsp;&nbsp;&nbsp; 本地代理信息选项用于本地代理所发送的路由器公告报文中，以指定本地代理的配置。本地代理信息选项的格式如图5-8所示：</P>
<P align=center><IMG src="../upload/1223270763171_pic.gif"></P>
<P align=center>图5-8&nbsp; 本地代理信息选项格式</P>
<P>&nbsp;&nbsp;&nbsp; 本地代理信息选项中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：本地代理信息选项类型为8。<BR>&nbsp;&nbsp;&nbsp; 长度：本地代理信息选项长度为1。<BR>&nbsp;&nbsp;&nbsp; 保留：保留字段留作将来使用，其长度为16位，且所有位都置为0。<BR>&nbsp;&nbsp;&nbsp; 本地代理优先级：本地代理优先级字段表示向移动节点发出地址的本地代理的优先级。优先级用于对本地代理发送给移动节点的地址进行排序。<BR>&nbsp;&nbsp;&nbsp; 本地代理生存期：本地代理生存期字段表示以秒为单位的本地代理的生存期。<BR>&nbsp;&nbsp;&nbsp; （8）路由信息选项<BR>&nbsp;&nbsp;&nbsp; 路由信息选项用于路由器公告报文中，接收报文的主机指定将添加到它们的本地路由表中的单个路由。路由信息选项的格式如图5-9所示：</P>
<P align=center><IMG src="../upload/1223270770609_pic.gif"></P>
<P align=center>图5-9&nbsp; 路由信息选项格式</P>
<P>&nbsp;&nbsp;&nbsp; 路由信息选项报文中各个字段的含义如下：<BR>&nbsp;&nbsp;&nbsp; 类型：路由信息选项类型为9。<BR>&nbsp;&nbsp;&nbsp; 长度：长度字段的值由路由的前缀长度和选项中的前缀字段的长度来决定。如果前缀长度为0（并且无前缀字段），那么长度字段的值为1。如果前缀长度大于0，小于65，而前缀字段的长度为64位，则长度字段的值为2。如果前缀长度大于64，而前缀字段的长度为128位，则长度字段的值为3。<BR>&nbsp;&nbsp;&nbsp; 前缀长度：前缀长度字段表示对路由有意义的前缀字段中的前缀的位数。它的取值范围为0到128。<BR>&nbsp;&nbsp;&nbsp; 保留1：留作将来使用，其长度为3位，且所有位都置为0。<BR>&nbsp;&nbsp;&nbsp; 优先级：优先级字段表示包含在路由信息选项中的路由的优先级。<BR>&nbsp;&nbsp;&nbsp; 保留2：留作将来使用，其长度为3位，且所有位都置为0。<BR>&nbsp;&nbsp;&nbsp; 路由生存期：路由生存期字段表示用于确定路由的前缀处于有效状态的时间（秒数）。长度为32位。如果此字段的值为0xFFFFFFFF，则表示路由生存期为永远。<BR>&nbsp;&nbsp;&nbsp; 前缀：前缀字段表示路由的前缀。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 