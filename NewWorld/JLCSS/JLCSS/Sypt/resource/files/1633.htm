<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">五.&nbsp;IPv4多播隧道<BR></td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>五.&nbsp;IPv4多播隧道</STRONG><BR>&nbsp;&nbsp;&nbsp; 6over4隧道，也称为IPv4多播隧道，是一个主机到主机，主机到路由器和路由器到主机的自动隧道技术，它为IPv6节点之间提供了跨越IPv4内部网络的单播网络的多播IPv6连通性。6over4在RFC2529中讲述。6over4主机使用有效单播地址的64位前缀，以及接口标识符::WWXX:YYZZ，这里WWXX:YYZZ是主机的IPv4地址（w.x.y.z）的冒号十六进制表示。默认情况下，6over4主机为每个6over4接口自动配置链路本地地址FE80::WWXX:YYZZ。<BR>&nbsp;&nbsp;&nbsp; 6over4协议将每个IPv4网络看成是一个具有多播能力的单独的链路。这就意味着邻节点发现过程（如：地址解析和路由器发现）可以像它们在一个具有多播功能的物理链路上一样运行。为模拟具有多播功能的链路，IPv4网络结构必须是具有IPv4多播功能的。<BR>&nbsp;&nbsp;&nbsp; 为便于在具有多播功能的IPv4网络上进行IPv6多播通信，RFC2529中定义了以下映射来将一个IPv6多播地址转换为IPv4多播地址：<BR>&nbsp;&nbsp;&nbsp; 239.192.[IPv6地址的倒数第二个字节].[IPv6地址的最后一个字节]<BR>&nbsp;&nbsp;&nbsp; 下面是IPv6多播地址映射的例子：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; FF02::1（链路本地范围所有节点多播地址）映射为239.192.0.1。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; FF02::2（链路本地范围所有路由器多播地址）映射为239.192.0.2。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; FF02::1:FF28:9C5A（请求节点多播地址）映射为239.192.156.90。<BR>&nbsp;&nbsp;&nbsp; 当启用了6over4时，如果接收到发往映射后的IPv4多播地址的IPv4多播通信流，IPv4协议层会使用IGMP报文来将自己的敏感地址通知给本地IPv4路由器。支持6over4的主机也会用它们的网卡注册与映射后的IPv4多播地址相应的其它多播MAC地址。例如，对于以太网卡：<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 与地址239.192.0.1相对应的多播MAC地址为01-00-5E-40-00-01。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 与地址239.192.0.2相对应的多播MAC地址为01-00-5E-40-00-02。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 与地址239.192.156.90相对应的多播MAC地址为01-00-5E-40-9C-5A。</P>
<P align=center><IMG src="../upload/1223273482171_pic.gif"></P>
<P align=center>图7-8&nbsp; 一个6over4配置</P>
<P>&nbsp;&nbsp;&nbsp; 由于IPv4网络用作一个具有多播功能的链路，因此主机可以使用邻节点请求报文和邻节点公告报文来互相解析对方的链路层地址。在6over4地址的接口标识符中内嵌的IPv4地址是隧道的端点。主机和路由器可以使用路由器请求报文和路由器公告报文来进行路由器、前缀和参数的发现。为处理邻节点发现报文，RFC2529定义了源链路层和目标链路层地址选项的格式：</P>
<P align=center><IMG src="../upload/1223273489390_pic.gif"></P>
<P align=center>图7-9&nbsp; 6over4的源链路层和目标链路层地址选项</P>
<P>&nbsp;&nbsp;&nbsp; 在地址字段中，前16位设置为0，其余32位为相应的IPv4地址。例如，当主机A（具有公共IPv4地址157.60.91.123以及相应的链路本地6over4地址FE80::9D3C:5B7B）发送通信流给主机B（具有公共IPv4地址131.107.210.49以及相应的链路本地6over4地址FE80::836B:D231）时，在IPv6和IPv4报头中的地址如表7-1所示：</P>
<P align=center>表7-1&nbsp; 6over4地址</P>
<P align=center><IMG src="../upload/1237267388203_pic.bmp"></P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 