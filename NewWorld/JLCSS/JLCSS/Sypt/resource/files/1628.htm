<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle">十一.&nbsp;ICMPv4差错报文与ICMPv6差错报文的比较<BR>十二.&nbsp;路径MTU与路径MTU发现<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; IPv6 MTU<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 路径MTU发现<BR>&nbsp;&nbsp;&nbsp; 3.&nbsp; PMTU的改变</td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>十一.&nbsp;ICMPv4差错报文与ICMPv6差错报文的比较</STRONG><BR>&nbsp;&nbsp;&nbsp; 按照ICMPv4报文的类型和代码字段的顺序，表3-3列出了常用的ICMPv4报文以及与它们相对应的ICMPv6报文。</P>
<P align=center>表 3-3&nbsp; ICMPv4与ICMPv6报文的比较</P>
<P align=center><IMG src="../upload/1223261704312_pic.gif"></P>
<P><STRONG>十二.&nbsp;路径MTU与路径MTU发现<BR>1.&nbsp; IPv6 MTU</STRONG><BR>&nbsp;&nbsp;&nbsp; IPv6要求链路层的最小MTU为1280字节。对于那些不支持这种MTU长度的链路层，就必须提供一个对IPv6透明的链路层的拆分和重组方案。而对于那些支持可配置的MTU长度的链路层，RFC2460建议它们配置的MTU长度最小为1500字节（对应于以太网Ⅱ封装的IPv6MTU）。<BR>&nbsp;&nbsp;&nbsp; 与IPv4一样，IPv6提供了一个使用ICMPv6包过大报文的路径MTU发现过程。路径MTU发现过程允许传输长度超过1280字节的IPv6数据包。<BR>&nbsp;&nbsp;&nbsp; IPv6源主机可以通过使用前面讲到的分片选项报头，来对长度大于路径MTU的上层协议有效载荷进行拆分。然而，我们极不赞成使用IPv6拆分操作。另外，一个IPv6节点必须能够重组长度至少为1500字节的数据包。<BR><STRONG>2.&nbsp; 路径MTU发现</STRONG><BR>&nbsp;&nbsp;&nbsp; 当有大量数据需要发送时，发送可能的最大长度数据包，将使网络的使用效率达到最大。由于IPv6路由器不再支持拆分，因此，发送方必须采取以下两种策略之一：其一是对有效载荷进行拆分（不推荐）；其二是发现能够发送到目标的最大长度数据包，并以此大小发送未拆分的数据包。<BR>&nbsp;&nbsp;&nbsp; 路径最大传输单元（PMTU）是在源站和目标节点之间的路径上的任一链路所支持的最小链路MTU。链路MTU是能够在这个链路上发送的最大长度的链路层有效载荷。这就相当于能够在这个链路上发送的最大长度的数据包，但与能够在这个链接上发送的最大长度的帧不同。最大长度的帧包括了链路层协议的报头和尾部。例如，对于使用以太网Ⅱ封装的以太网链路来说，链路MTU为1500字节，而最大长度的帧为1526字节（这包括了以太网前导码、源地址和目的地址、以太网类型字段和帧校验序列字段）。<BR>&nbsp;&nbsp;&nbsp; 以当前路径的PMTU为长度的IPv6数据包不需要经过发送方的拆分处理，就可以被此路径上的所有路由器成功转发。为发现当前路径的PMTU，发送方就需要依赖接收到的ICMPv6包过大报文。PMTU的发现要经过以下过程：<BR>&nbsp;&nbsp;&nbsp; （1）发送节点假定到目标的PMTU就是当前正在进行转发的接口的链路MTU。<BR>&nbsp;&nbsp;&nbsp; （2）发送节点以假定的PMTU长度发送IPv6数据包。<BR>&nbsp;&nbsp;&nbsp; （3）如果这条路径上的一个路由器因为接口的链路MTU小于数据包的长度而不能转发此数据包，那么这个路由器会将一个ICMPv6包过大报文发回给发送点，并丢弃此IPv6数据包。ICMPv6的包过大报文包含了转发失败的网络接口的链路MTU。<BR>&nbsp;&nbsp;&nbsp; （4）根据ICMPv6包过大报文中的MTU字段值，发送节点设置新的发送到目标的数据包的假定PMTU。<BR>&nbsp;&nbsp;&nbsp; 发送节点在第（2）和第（4）步之间多次往复，直至发现最终PMTU。当发送方再也接收不到新的包过大报文，或者发送方接收到了来自接收方的确认或应答数据包时，PMTU就得以确定。<BR>&nbsp;&nbsp;&nbsp; RFC1981建议IPv6节点支持PMTU发现，那些不支持PMTU发现的节点，必须使用1280字节的最小链路MTU，作为其所有路径的PMTU。<BR><STRONG>3.&nbsp; PMTU的改变(
<OBJECT codeBase=http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0 classid=clsid:D27CDB6E-AE6D-11cf-96B8-444553540000><PARAM NAME="_cx" VALUE="5080"><PARAM NAME="_cy" VALUE="5080"><PARAM NAME="FlashVars" VALUE=""><PARAM NAME="Movie" VALUE="../upload/1228201490734_swf.swf"><PARAM NAME="Src" VALUE="../upload/1228201490734_swf.swf"><PARAM NAME="WMode" VALUE="Window"><PARAM NAME="Play" VALUE="-1"><PARAM NAME="Loop" VALUE="-1"><PARAM NAME="Quality" VALUE="High"><PARAM NAME="SAlign" VALUE=""><PARAM NAME="Menu" VALUE="-1"><PARAM NAME="Base" VALUE=""><PARAM NAME="AllowScriptAccess" VALUE=""><PARAM NAME="Scale" VALUE="ShowAll"><PARAM NAME="DeviceFont" VALUE="0"><PARAM NAME="EmbedMovie" VALUE="0"><PARAM NAME="BGColor" VALUE=""><PARAM NAME="SWRemote" VALUE=""><PARAM NAME="MovieData" VALUE=""><PARAM NAME="SeamlessTabbing" VALUE="1"><PARAM NAME="Profile" VALUE="-1"><PARAM NAME="ProfileAddress" VALUE=""><PARAM NAME="ProfilePort" VALUE="1886930208"><PARAM NAME="AllowNetworking" VALUE="all"><PARAM NAME="AllowFullScreen" VALUE="false">
<embed src=../upload/1228201490734_swf.swf 
pluginspage=<A>'</A>http://www.macromedia.com/go/getflashplayer<A>'</A> 
type=<A>'</A>application/x-shockwave-flash<A>'</A>  width=100% height=100%></embed></OBJECT>)</STRONG><BR>&nbsp;&nbsp;&nbsp; 由于路由拓扑结构的变化，源节点和目标节点之间的路径会随着时间而改变。当新路径要求一个较低的PMTU时，可以直接从上面描述的发现PMTU过程中的第（3）步开始，并在第（2）步和第（4）步之间往复进行，直至发现新的PMTU。<BR>&nbsp;&nbsp;&nbsp; 路径MTU的减小，可以通过接收到的ICMPv6包过大报文被立即发现。而路径MTU的增大，则必须通过发送方的检测才能发现。根据RFC1981，发送方可以通过试图发送更长的数据包来进行检测。而这种检测应该在距离接收到ICMPv6包过大报文最少5分钟（建议取10分钟）之后进行。</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 