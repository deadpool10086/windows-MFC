<html> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <link href="inc/style.css" rel="stylesheet" type="text/css"> </head>  <body class=infobody> <table width="100%" height="100%" cellspacing="0">  <tr>  <td valign="top"> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>内容摘要</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P>九. 交付与转发<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 交付<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 连接类型<BR>&nbsp;&nbsp;&nbsp; 3.&nbsp; 直接交付与间接交付<BR>&nbsp;&nbsp;&nbsp; 4.&nbsp; 转发<BR>&nbsp;&nbsp;&nbsp; 5.&nbsp; 转发技术<BR>十. 路由选择<BR>&nbsp;&nbsp;&nbsp; 1.&nbsp; 静态和动态路由选择<BR>&nbsp;&nbsp;&nbsp; 2.&nbsp; 路由表</P></td>             </tr>           </table> <table>   <tr>   <td height=25></td>   </tr>           <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border-bottom:#1873b5 solid 1px">             <tr><td style="background-image:url(images/cinfo_left.GIF);display:" width="5"></td>               <td width="86" height="28" style="padding-left:4px;padding-right:4px;background-image:url(images/cinfo_center.GIF);color:#3081bd;text-align:center;padding-bottom:0px;padding-top:4px;display:"><nobr>相关内容</nobr></td> <td style="background-image:url(images/cinfo_right.GIF);display:" width="5"></td>               <td>&nbsp;</td>             </tr>           </table>           <table width="100%" border="0" align="center" cellpadding="5" cellspacing="1" bgcolor="#FFFFFF" style="border:#1873b5 solid 1px;border-top:0px">             <tr>               <td bgcolor="#F5FAFA" style="padding-left:20;padding-right:20px" id="ptitle"><P><STRONG>九. 交付与转发</STRONG><BR>&nbsp;&nbsp;&nbsp; 所谓交付，是指在网络层的控制下，一个数据包被底层网络处理的方式。例如，面向无连接的服务和面向连接的服务，以及直接交付和间接交付等。<BR>所谓转发是指数据包被交付到下一站的方式。<BR><STRONG>1.&nbsp; 交付</STRONG><BR>&nbsp;&nbsp;&nbsp; 网络层控制底层物理网络对数据包的处理过程，这种过程叫做交付。在交付过程中有几个重要概念，即连接类型，直接与间接交付。<BR><STRONG>2.&nbsp; 连接类型</STRONG><BR>&nbsp;&nbsp;&nbsp; 数据包在网络层的交付可以用面向连接的服务或无连接服务来完成。<BR>&nbsp;&nbsp;&nbsp; （1）面向连接服务<BR>&nbsp;&nbsp;&nbsp; 在面向连接服务的情况下，本地网络层协议在发送数据包之前先要和远地网络层协议建立一条连接。当连接建立后，一系列的数据包就从源点一个接一个地发送到终点。在这种情况下，各个数据包之间存在着一种关系。它们都沿着同一条路径按序发送。一个数据包与走在它前面的数据包以及与走在它后面的数据包在逻辑上是连接在一起的。若报文中的所有数据包都已被交付，连接就终止了。<BR>&nbsp;&nbsp;&nbsp; 在面向连接服务的情况下，对从同一个源点到同一个终点的一系列数据包来说，其路由的确定只需进行一次。路由器不需要对每一个单个的数据包重新计算路由。<BR>&nbsp;&nbsp;&nbsp; （2）无连接服务<BR>&nbsp;&nbsp;&nbsp; 在无连接服务的情况下，网络协议独立地对待每一个数据包，而每一个数据包与任何其它数据包都没有关系。一个报文中的各数据包到它们的终点可以走相同的路径也可以走不同的路径。在无连接服务的情况下，对一个数据包的路由是由每一个路由器单独地确定。IP协议是无连接协议，它提供无连接服务。<BR><STRONG>3.&nbsp; 直接交付与间接交付</STRONG><BR>&nbsp;&nbsp;&nbsp; 把一个数据包交付到它最后的终点有两种方式：直接交付和间接交付。<BR>&nbsp;&nbsp;&nbsp; （1）直接交付<BR>&nbsp;&nbsp;&nbsp; 在直接交付的情况下，数据包的最后终点是与交付者连接在同一个网络上的主机。当数据包的源点和终点都在同一个物理网络上时，或者交付是在最后一个路由器与目的主机之间进行时，就为直接交付，如下图所示。</P>
<P align=center><IMG src="../upload/1222568102078_pic.gif"></P>
<P align=center>图3-13&nbsp; 直接交付</P>
<P>&nbsp;&nbsp;&nbsp; 发送端很容易确定交付是否为直接交付。发送端可以提取出终点的网络地址（使用掩码），并与它所连接的网络的网络地址相比较。若匹配，交付就是直接的。<BR>&nbsp;&nbsp;&nbsp; 在直接交付时，发送端使用目的IP地址找出目的物理地址。然后把目的IP地址和目的物理地址一起交付给数据链路层，以便进行实际的交付。这个过程叫做把IP地址映射到物理地址。地址解析协议（ARP）可以动态地把IP地址映射到相应的物理地址。<BR>&nbsp;&nbsp;&nbsp; （2）间接交付<BR>&nbsp;&nbsp;&nbsp; 如果目的主机与交付者不在同一个网络上，数据包就要进行间接交付。在间接交付时，数据包从一个路由器传送到另一个路由器，直到这个数据包到达与最后的终点连接在同一个网络上的路由器为止。如下图所示。</P>
<P align=center><IMG src="../upload/1222568111000_pic.gif"></P>
<P align=center>图3-14&nbsp; 间接交付</P>
<P>&nbsp;&nbsp;&nbsp; 交付永远包括一个直接交付，以及零个或多个间接交付。最后的交付就是直接交付。<BR>&nbsp;&nbsp;&nbsp; 在间接交付中，发送端使用目的IP地址和路由表来找出下一个路由器的IP地址。然后使用ARP协议找出下一个路由器的物理地址。在直接交付时，地址的映射是在终点的IP地址与终点的物理地址之间进行的。在间接交付时，地址的映射是在下一个路由器的IP地址与下一个路由器的物理地址之间进行的。<BR><STRONG>4.&nbsp; 转发</STRONG><BR>&nbsp;&nbsp;&nbsp; 转发表示把数据包放到去终点的路由上。进行转发就要求主机或路由器装有路由表。当主机有数据包要发送时，或路由器收到数据包要进行转发时，就要查找路由表，以便找出到达最后终点的路由。但是，这种简单的转发方法，在今天的互联网中已经变得不可能了，因为路由表中的项目数已使得路由表的查找效率非常低。<BR><STRONG>5.&nbsp; 转发技术</STRONG><BR>&nbsp;&nbsp;&nbsp; 使用一些转发技术可以减小路由表的大小，同时还能够处理一些安全问题。下面为三种简单的转发技术。<BR>&nbsp;&nbsp;&nbsp; （1）下一跳方法<BR>下一跳方法就是在路由表中只保留下一跳的地址，而不是保留完整路由信息。下图所描绘的例子说明了路由表如何被简化。</P>
<P align=center><IMG src="../upload/1222568120531_pic.gif"></P>
<P align=center>图3-15&nbsp; 下一跳方法</P>
<P>&nbsp;&nbsp;&nbsp; （2）特定网络方法<BR>&nbsp;&nbsp;&nbsp; 特定网络方法不是对连接在同一个物理网络上的所有主机都设置一个路由表项，而是仅用一个路由表项来代表这个目的网络本身的地址。换言之，这种技术把连接在同一个网络上的所有主机看成是一个路由表项。如下图所示：</P>
<P align=center><IMG src="../upload/1222568129187_pic.gif"></P>
<P align=center>图3-16&nbsp; 特定网络方法</P>
<P>&nbsp;&nbsp;&nbsp; （3）特定主机方法<BR>&nbsp;&nbsp;&nbsp; 特定主机方法将目的主机地址在路由表中全部给出。这种方法与特定网络方法的思想相反。这是用牺牲效率来换取其它一些优点的方法。虽然把主机地址放在路由表中会降低效率，但有时管理员还是想对路由选择作出更多的控制。如下图所示：</P>
<P align=center><IMG src="../upload/1222568156015_pic.gif"></P>
<P align=center>图3-17&nbsp; 特定主机方法</P>
<P><STRONG>十. 路由选择</STRONG><BR>&nbsp;&nbsp;&nbsp; 路由选择涉及的问题是创建和维护路由表。<BR><STRONG>1.&nbsp; 静态和动态路由选择<BR></STRONG>&nbsp;&nbsp;&nbsp; 主机或路由器要转发IP数据包就要有一个路由表，并给每一个终点或一组终点设置一个路由表项。路由表可以是静态的，也可以是动态的。<BR>&nbsp;&nbsp;&nbsp; （1）静态路由表<BR>&nbsp;&nbsp;&nbsp; 静态路由表中的路由信息是由管理员手动设置的。管理员把到达每一个终点的路由输入到路由表中。路由表的更新由管理员手动完成。<BR>&nbsp;&nbsp;&nbsp; 静态路由表用在不会经常变动的小型互联网中，或用在故障查找的试验互联网中。在大的互联网中很少使用静态路由表。<BR>&nbsp;&nbsp;&nbsp; （2）动态路由表<BR>&nbsp;&nbsp;&nbsp; 动态路由表使用一种动态路由选择协议，如RIP、OSPF（关于这两个协议，请参考实验十六，实验十七）。当网络中发生变化时，动态路由选择协议就更新所有路由器中的路由表。<BR>&nbsp;&nbsp;&nbsp; 为了有效地交付IP数据包，规模较大的网络一般使用动态路由表。<BR><STRONG>2.&nbsp; 路由表</STRONG><BR>&nbsp;&nbsp;&nbsp; 下图给出了路由表中常用的一些列：</P>
<P align=center><IMG src="../upload/1222568178562_pic.gif"></P>
<P align=center>图3-18&nbsp; 路由表中常用的列</P>
<P>&nbsp;&nbsp;&nbsp; ●&nbsp; 掩码：这列定义应用到路由表项的掩码。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 网络地址：这列定义数据包要交付到的网络地址。在特定主机路由选择中，这个字段定义目的主机的地址。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 下一跳地址：这列定义了数据包要交付到的下一跳路由器的地址。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 接口：这列指出接口的名字。<BR>&nbsp;&nbsp;&nbsp; ●&nbsp; 标志：这列定义了五个标志：U（Up，工作），G（网关），H（特定主机），D（因改变路由而增加的）和M（因改变路由而修改的）。<BR>路由选择过程如下图所示：</P>
<P align=center><IMG src="../upload/1223253784140_pic.gif"></P>
<P align=center>图3-19&nbsp; 路由表使用过程</P></td>             </tr>           </table>  </td> </tr> </table> </body> </html> <script> if(window.HTMLElement) {     HTMLElement.prototype.__defineSetter__("outerHTML",function(sHTML){         var r=this.ownerDocument.createRange();         r.setStartBefore(this);         var df=r.createContextualFragment(sHTML);         this.parentNode.replaceChild(df,this);         return sHTML;         });      HTMLElement.prototype.__defineGetter__("outerHTML",function(){      var attr;         var attrs=this.attributes;         var str="<"+this.tagName.toLowerCase();         for(var i=0;i<attrs.length;i++){             attr=attrs[i];             if(attr.specified)                 str+=" "+attr.name+'="'+attr.value+'"';             }         if(!this.canHaveChildren)             return str+">";         return str+">"+this.innerHTML+"</"+this.tagName.toLowerCase()+">";         });           HTMLElement.prototype.__defineGetter__("canHaveChildren",function(){   switch(this.tagName.toLowerCase()){             case "area":             case "base":          case "basefont":             case "col":             case "frame":             case "hr":             case "img":             case "br":             case "input":             case "isindex":             case "link":             case "meta":             case "param":             return false;         }         return true;       }); }  function showMe(i) {  	objHtml=document.all["s"+i].innerHTML; 	date=new Date(); 	if(navigator.userAgent.indexOf("MSIE")>0) 		window.status="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	else 		top.document.title="cmdOpen,"+date.getTime()+","+(objHtml.substring(objHtml.lastIndexOf("\"",objHtml.indexOf(".swf\""))+1,objHtml.indexOf(".swf\"")+4)); 	}  	if(navigator.userAgent.indexOf("MSIE")>0) 	var objects=document.all.tags("OBJECT"); 	else 	var objects=document.getElementsByTagName("OBJECT"); 	for(i=0;i<objects.length;i++) { objects[i].style.width="100%"; objects[i].outerHTML="<a href=# onclick=\"showMe("+i+")\">动画演示</a><span id=s"+i+" style=\"display:none\">"+objects[i].outerHTML+"</span>"; } var iHtml=document.body.innerHTML;  </script> 